<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒ‘ãƒ‹ãƒ‘ãƒ‹ç¿»è¨³ã‚¢ãƒ—ãƒª v4.0</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="ãƒ‘ãƒ‹ãƒ‘ãƒ‹">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', 'Hiragino Kaku Gothic ProN', 'Hiragino Sans', Meiryo, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 10px;
        }

        .container {
            max-width: 500px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .header {
            text-align: center;
            margin-bottom: 20px;
        }

        .title {
            color: #333;
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .version {
            background: linear-gradient(135deg, #e74c3c 0%, #f39c12 100%);
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
            display: inline-block;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #666;
            font-size: 14px;
        }

        .translation-mode {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 20px;
            text-align: center;
        }

        .mode-switch {
            display: flex;
            background: #e9ecef;
            border-radius: 25px;
            padding: 4px;
            margin-bottom: 10px;
        }

        .mode-btn {
            flex: 1;
            padding: 8px 16px;
            border: none;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            background: transparent;
            color: #666;
        }

        .mode-btn.active {
            background: #667eea;
            color: white;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
        }

        .mode-description {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }

        .input-group {
            margin-bottom: 15px;
        }

        .label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #555;
        }

        .text-input {
            width: 100%;
            min-height: 80px;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 16px;
            font-family: inherit;
            resize: vertical;
            transition: all 0.3s;
        }

        .text-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .button-group {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .btn {
            flex: 1;
            min-width: 80px;
            padding: 12px 16px;
            border: none;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-family: inherit;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #f8f9fa;
            color: #667eea;
            border: 2px solid #667eea;
        }

        .btn-secondary:hover {
            background: #667eea;
            color: white;
        }

        .btn-success {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
        }

        .output {
            background: linear-gradient(135deg, #e8f4f8 0%, #f0f8ff 100%);
            border-radius: 10px;
            padding: 15px;
            min-height: 60px;
            margin-bottom: 15px;
            font-size: 18px;
            font-weight: 500;
            color: #2c3e50;
            border-left: 4px solid #667eea;
        }

        .output.empty {
            color: #999;
            font-style: italic;
        }

        .analysis {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            min-height: 80px;
            font-size: 14px;
            color: #666;
            line-height: 1.6;
            border: 1px solid #e9ecef;
            max-height: 200px;
            overflow-y: auto;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
        }

        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            border-radius: 15px;
            padding: 20px;
            max-width: 90%;
            max-height: 80%;
            overflow-y: auto;
        }

        .modal-title {
            text-align: center;
            margin-bottom: 15px;
            font-size: 18px;
            font-weight: bold;
            color: #333;
        }

        .vocab-item {
            padding: 8px;
            margin: 4px 0;
            background: #f8f9fa;
            border-radius: 5px;
            border-left: 3px solid #667eea;
        }

        .phrase-item {
            padding: 10px;
            margin: 6px 0;
            background: #e8f5e8;
            border-radius: 5px;
            border-left: 3px solid #28a745;
            cursor: pointer;
        }

        .phrase-item:hover {
            background: #d4edda;
        }

        .phrase-panipani {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 3px;
        }

        .phrase-meaning {
            font-size: 13px;
            color: #666;
        }

        .example-section {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 10px;
            margin-bottom: 15px;
        }

        .example-title {
            font-weight: bold;
            color: #856404;
            margin-bottom: 5px;
            font-size: 12px;
        }

        .example-text {
            font-size: 13px;
            color: #856404;
            cursor: pointer;
        }

        .example-text:hover {
            text-decoration: underline;
        }

        .tab-buttons {
            display: flex;
            background: #f8f9fa;
            border-radius: 10px;
            padding: 4px;
            margin-bottom: 15px;
        }

        .tab-btn {
            flex: 1;
            padding: 8px 12px;
            border: none;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            background: transparent;
            color: #666;
        }

        .tab-btn.active {
            background: white;
            color: #333;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        @media (max-width: 480px) {
            .container {
                margin: 5px;
                padding: 15px;
                border-radius: 15px;
            }
            
            .button-group {
                flex-direction: column;
            }
            
            .btn {
                flex: none;
                margin: 2px 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 class="title">ğŸŒ¸ ãƒ‘ãƒ‹ãƒ‘ãƒ‹ç¿»è¨³ã‚¢ãƒ—ãƒª ğŸŒ¸</h1>
            <div class="version">v4.0 å®Œå…¨æ–‡æ³•æº–æ‹ </div>
            <p class="subtitle">17èªã®äººå·¥è¨€èªãƒ‘ãƒ‹ãƒ‘ãƒ‹ã®å®Œå…¨æ–‡æ³•ã‚¨ãƒ³ã‚¸ãƒ³</p>
        </div>
        
        <!-- ç¿»è¨³ãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆ -->
        <div class="translation-mode">
            <div class="mode-switch">
                <button id="modeJaToPa" class="mode-btn active">ğŸ‡¯ğŸ‡µâ†’ğŸŒ¸</button>
                <button id="modePaToJa" class="mode-btn">ğŸŒ¸â†’ğŸ‡¯ğŸ‡µ</button>
            </div>
            <div id="modeText" class="mode-description">æ—¥æœ¬èª â†’ ãƒ‘ãƒ‹ãƒ‘ãƒ‹èª</div>
        </div>

        <!-- ä¾‹æ–‡è¡¨ç¤º -->
        <div id="exampleSection" class="example-section">
            <div class="example-title">ğŸ’¡ ä¾‹æ–‡:</div>
            <div id="exampleText" class="example-text">ã‚ã‚Œã¯æ¡œã§ã™</div>
        </div>
        
        <div class="input-group">
            <label id="inputLabel" class="label">ğŸ‡¯ğŸ‡µ æ—¥æœ¬èªã‚’å…¥åŠ›:</label>
            <textarea 
                id="inputText" 
                class="text-input" 
                placeholder="ä¾‹: ã‚ã‚Œã¯æ¡œã§ã™"
                rows="3"
            ></textarea>
        </div>
        
        <div class="button-group">
            <button id="translateBtn" class="btn btn-primary">ğŸ”„ ç¿»è¨³</button>
            <button id="clearBtn" class="btn btn-secondary">ğŸ—‘ï¸ ã‚¯ãƒªã‚¢</button>
            <button id="vocabBtn" class="btn btn-secondary">ğŸ“š èªå½™è¡¨</button>
            <button id="phrasesBtn" class="btn btn-success">ğŸ’¬ ã‚ã„ã•ã¤</button>
        </div>
        
        <div class="input-group">
            <label id="outputLabel" class="label">ğŸŒŸ ãƒ‘ãƒ‹ãƒ‘ãƒ‹èª:</label>
            <div id="output" class="output empty">ã“ã“ã«ç¿»è¨³çµæœãŒè¡¨ç¤ºã•ã‚Œã¾ã™</div>
        </div>
        
        <div class="input-group">
            <label class="label">ğŸ” ç¿»è¨³åˆ†æ:</label>
            <div id="analysisOutput" class="analysis"></div>
        </div>
    </div>

    <!-- èªå½™è¡¨ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="vocabModal" class="modal">
        <div class="modal-content">
            <div class="modal-title">ğŸ“š ãƒ‘ãƒ‹ãƒ‘ãƒ‹èªå½™è¡¨ (17èª)</div>
            <div id="vocabList"></div>
            <button id="closeVocabModal" class="btn btn-secondary" style="width: 100%; margin-top: 15px;">é–‰ã˜ã‚‹</button>
        </div>
    </div>

    <!-- ã‚ã„ã•ã¤ãƒ»æ…£ç”¨å¥ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="phrasesModal" class="modal">
        <div class="modal-content">
            <div class="modal-title">ğŸ’¬ ã‚ã„ã•ã¤ãƒ»æ…£ç”¨å¥é›†</div>
            
            <div class="tab-buttons">
                <button class="tab-btn active" data-tab="greetings">ã‚ã„ã•ã¤</button>
                <button class="tab-btn" data-tab="expressions">è¡¨ç¾</button>
                <button class="tab-btn" data-tab="prepositions">å‰ç½®è©</button>
            </div>

            <div id="greetings" class="tab-content active">
                <div id="greetingsList"></div>
            </div>

            <div id="expressions" class="tab-content">
                <div id="expressionsList"></div>
            </div>

            <div id="prepositions" class="tab-content">
                <div id="prepositionsList"></div>
            </div>
            
            <button id="closePhrasesModal" class="btn btn-secondary" style="width: 100%; margin-top: 15px;">é–‰ã˜ã‚‹</button>
        </div>
    </div>

    <script>
        // ãƒ‘ãƒ‹ãƒ‘ãƒ‹å®Œå…¨æ–‡æ³•ã‚¨ãƒ³ã‚¸ãƒ³ v4.0 (ä¿®æ­£ç‰ˆ)
        class PaniPaniGrammarEngine {
            constructor() {
                // ãƒ‘ãƒ‹ãƒ‘ãƒ‹ã®17ã®èªå½™ï¼ˆå…¬å¼ç‰ˆï¼‰
                this.vocabulary = {
                    'kai': 'è¡Œãã€æ¥ã‚‹ã€æ­©ãã€å‹•ãã€å¤‰ã‚ã‚‹',
                    'kin': 'å¾—ã‚‹ã€é£Ÿã¹ã‚‹ã€é£²ã‚€',
                    'ma': 'ã„ã‚‹ã€ã‚ã‚‹ã€ç”Ÿãã¦ã„ã‚‹',
                    'mai': 'ç”Ÿç‰©',
                    'na': 'ç§ã€ã‚ãªãŸã€ã‚ã®äººï¼ˆãŸã¡ï¼‰ã€ã“ã‚Œã€ãã‚Œã€ã‚ã‚Œ',
                    'ni': 'å¤§ãã„ã€é«˜ã„ã€å¤šã„ã€ãŸãã•ã‚“ã€ã¨ã¦ã‚‚ã€æˆé•·ã™ã‚‹',
                    'nui': 'å‰ç½®è©åŒ–',
                    'pa': 'è¨€ã†ã€è©±ã™ã€èãã€æ›¸ãã€æãã€è¦‹ã‚‹ã€èª­ã‚€ã€é€ä¿¡ã™ã‚‹ã€å—ä¿¡ã™ã‚‹ã€æ„Ÿã˜ã‚‹ã€åˆºæ¿€ã™ã‚‹ã€åˆºæ¿€ã‚’å—ã‘ã‚‹ã€ã“ã¨ã°ã€è¨€èªã€éŸ³ã€éŸ³æ¥½ã€æ–‡å­—ã€å½¢ã€çµµã€å†™çœŸã€åˆºæ¿€',
                    'pai': 'è»½ã„ã€è»½ã•ã€ç°¡å˜ã€ç°¡å˜ãªã“ã¨',
                    'pin': 'æ˜ã‚‹ã„ã€æ˜ã‚‹ã•ã€å…‰ã€è‰²',
                    'pu': 'ï½ã§ã¯ãªã„ã€ï½ã—ãªã„',
                    'ru': 'å ´æ‰€ã€ã¨ã“ã‚ã€æ™‚é–“ã€ã¨ã',
                    'sa': 'çŸ¥ã‚‹ã€ã‚ã‹ã‚‹ã€çŸ¥ã‚‰ã‚Œã¦ã„ã‚‹ã€çŸ¥è­˜ã€ç¿’ã†ã€æ•™ã‚ã‚‹ã€è€ƒãˆã‚‹ã€è€ƒãˆ',
                    'sai': 'ã‚ˆã„ã€ã‚ˆã„ã“ã¨ã€æ¥½ã—ã„ã€æ¥½ã—ã‚€ã€æ¥½ã—ã•ã€ç¾ã—ã„ã€ç¾ã—ã•',
                    'sin': 'ä½¿ã†ã€ä½¿ç”¨',
                    'ta': 'ä½•ã€èª°',
                    'tin': 'ã™ã‚‹ã€ã¤ãã‚‹'
                };

                // ã‚ã„ã•ã¤ãƒ»æ…£ç”¨å¥ï¼ˆå…¬å¼ï¼‰
                this.greetings = {
                    'na sai!': 'ã‚„ãï¼',
                    'sai!': 'ã‚„ãï¼',
                    'pu pu na sai?': 'å…ƒæ°—ï¼Ÿ',
                    'pin kai': 'ãŠã¯ã‚ˆã†ãƒ»ã“ã‚“ã°ã‚“ã¯',
                    'pin ma': 'ã“ã‚“ã«ã¡ã¯',
                    'na pin kai na tin': 'ãŠã‚„ã™ã¿',
                    'na pin kai na tin sai': 'ãŠã‚„ã™ã¿ï¼ˆéŸ»ã‚ã‚Šï¼‰',
                    'pu na sai': 'ã•ã‚ˆã†ãªã‚‰',
                    'na sai': 'ã•ã‚ˆã†ãªã‚‰',
                    'na na kai sai!': 'ã‚ã‚ŠãŒã¨ã†ï¼',
                    'na na kin sai!': 'ãŒã‚“ã°ã‚Œï¼ãƒ»ã‚ã‚ŠãŒã¨ã†ï¼',
                    'kin sai!': 'ãŒã‚“ã°ã‚Œï¼'
                };

                // å‰ç½®è©ï¼ˆå…¬å¼ï¼‰
                this.prepositions = {
                    'nui kai': 'ï½ã«ã€ï½ã¸ã€ï½ã®ãŸã‚ã«',
                    'nui kin': 'ï½ã‹ã‚‰',
                    'nui ru': 'ï½ï¼ˆã¨ã„ã†å ´æ‰€ï¼‰ã§ã€ï½ï¼ˆã„ã¤ï¼‰ã«',
                    'nui sin': 'ï½ã‚’ä½¿ã£ã¦'
                };

                // è¡¨ç¾ä¾‹ï¼ˆå…¬å¼ï¼‰
                this.expressions = {
                    'mai sai': 'ã‚ˆã„ç”Ÿç‰©ãƒ»ç¾ã—ã„ç”Ÿç‰©',
                    'sai mai': 'ã‚ˆã„ç”Ÿç‰©ãƒ»ç¾ã—ã„ç”Ÿç‰©',
                    'pu pin ru': 'æš—ã„ã¨ã“ã‚',
                    'ru pu pin': 'æš—ã„ã¨ã“ã‚',
                    'ru sa': 'å­¦æ ¡ï¼ˆå­¦ã¶å ´æ‰€ï¼‰',
                    'sa ru': 'å­¦æ ¡ï¼ˆå­¦ã¶å ´æ‰€ï¼‰',
                    'na pai na sai': 'ç°¡å˜ãªã®ãŒè‰¯ã„ã“ã¨',
                    'pu pu': 'ç–‘å•æ–‡ã®å°ï¼ˆæ–‡é ­ã«ç½®ãï¼‰'
                };

                // åŸºæœ¬èªå½™ã®æ—¥æœ¬èªâ†’ãƒ‘ãƒ‹ãƒ‘ãƒ‹è¾æ›¸ï¼ˆä¿®æ­£ç‰ˆï¼‰
                this.japaneseToPs = {
                    // ä»£åè©
                    'ç§': 'na', 'ã‚ãªãŸ': 'na', 'å½¼': 'na', 'å½¼å¥³': 'na',
                    'ã“ã‚Œ': 'na', 'ãã‚Œ': 'na', 'ã‚ã‚Œ': 'na', 'èª°': 'ta', 'ä½•': 'ta',
                    
                    // å‹•è©ï¼ˆåŸºæœ¬å½¢ã¨æ´»ç”¨å½¢ã‚’æ˜ç¢ºã«åˆ†ã‘ã¦å®šç¾©ï¼‰
                    'è¡Œã': 'kai', 'è¡Œã': 'kai', 'è¡Œãã¾ã™': 'kai', 'è¡Œã£ãŸ': 'kai',
                    'æ¥ã‚‹': 'kai', 'æ¥ã¾ã™': 'kai', 'æ­©ã': 'kai', 'æ­©ãã¾ã™': 'kai', 
                    'å‹•ã': 'kai', 'å‹•ãã¾ã™': 'kai', 'å¤‰ã‚ã‚‹': 'kai', 'å¤‰ã‚ã‚Šã¾ã™': 'kai',
                    
                    'é£Ÿã¹ã‚‹': 'kin', 'é£Ÿã¹ã¾ã™': 'kin', 'é£²ã‚€': 'kin', 'é£²ã¿ã¾ã™': 'kin', 
                    'å¾—ã‚‹': 'kin', 'å¾—ã¾ã™': 'kin', 'ã‚‚ã‚‰ã†': 'kin', 'ã‚‚ã‚‰ã„ã¾ã™': 'kin',
                    
                    'ã„ã‚‹': 'ma', 'ã„ã¾ã™': 'ma', 'ã‚ã‚‹': 'ma', 'ã‚ã‚Šã¾ã™': 'ma', 
                    'ç”Ÿãã‚‹': 'ma', 'ç”Ÿãã¾ã™': 'ma',
                    
                    'è¨€ã†': 'pa', 'è¨€ã„ã¾ã™': 'pa', 'è©±ã™': 'pa', 'è©±ã—ã¾ã™': 'pa', 
                    'èã': 'pa', 'èãã¾ã™': 'pa', 'æ›¸ã': 'pa', 'æ›¸ãã¾ã™': 'pa', 
                    'è¦‹ã‚‹': 'pa', 'è¦‹ã¾ã™': 'pa', 'èª­ã‚€': 'pa', 'èª­ã¿ã¾ã™': 'pa',
                    'æã': 'pa', 'æãã¾ã™': 'pa', 'æ„Ÿã˜ã‚‹': 'pa', 'æ„Ÿã˜ã¾ã™': 'pa', 
                    'é€ã‚‹': 'pa', 'é€ã‚Šã¾ã™': 'pa', 'å—ä¿¡': 'pa',
                    
                    'çŸ¥ã‚‹': 'sa', 'çŸ¥ã‚Šã¾ã™': 'sa', 'ã‚ã‹ã‚‹': 'sa', 'ã‚ã‹ã‚Šã¾ã™': 'sa', 
                    'ç¿’ã†': 'sa', 'ç¿’ã„ã¾ã™': 'sa', 'å­¦ã¶': 'sa', 'å­¦ã³ã¾ã™': 'sa', 
                    'æ•™ãˆã‚‹': 'sa', 'æ•™ãˆã¾ã™': 'sa', 'è€ƒãˆã‚‹': 'sa', 'è€ƒãˆã¾ã™': 'sa',
                    
                    'ä½¿ã†': 'sin', 'ä½¿ã„ã¾ã™': 'sin', 'ä½¿': 'sin', 'ä½¿ã„': 'sin', 
                    'ã™ã‚‹': 'tin', 'ã—ã¾ã™': 'tin', 'ä½œã‚‹': 'tin', 'ä½œã‚Šã¾ã™': 'tin', 
                    'ã¤ãã‚‹': 'tin', 'ã¤ãã‚Šã¾ã™': 'tin',
                    
                    // å½¢å®¹è©ãƒ»å‰¯è©
                    'å¤§ãã„': 'ni', 'å¤§ããª': 'ni', 'é«˜ã„': 'ni', 'å¤šã„': 'ni', 'ãŸãã•ã‚“': 'ni', 'ã¨ã¦ã‚‚': 'ni',
                    'å¤§ã': 'ni', // æ´»ç”¨å¯¾å¿œ
                    'ã‚ˆã„': 'sai', 'ã„ã„': 'sai', 'æ¥½ã—ã„': 'sai', 'ç¾ã—ã„': 'sai',
                    'è»½ã„': 'pai', 'ç°¡å˜': 'pai', 'ç°¡å˜ãª': 'pai',
                    'æ˜ã‚‹ã„': 'pin', 'å…‰': 'pin', 'è‰²': 'pin',
                    
                    // åè©
                    'ç”Ÿç‰©': 'mai', 'å‹•ç‰©': 'mai', 'äºº': 'mai', 'äººé–“': 'mai',
                    'è¨€è‘‰': 'pa', 'éŸ³': 'pa', 'æ–‡å­—': 'pa', 'çµµ': 'pa', 'å†™çœŸ': 'pa',
                    'çŸ¥è­˜': 'sa', 'è€ƒãˆ': 'sa',
                    'å ´æ‰€': 'ru', 'æ™‚é–“': 'ru', 'ã¨ã': 'ru', 'ã¨ã“ã‚': 'ru',
                    
                    // å›ºæœ‰åè©ï¼ˆä¾‹ï¼‰
                    'ãƒŸã‚«': 'mika', 'ã¡ã•': 'chisa', 'ã¯ãª': 'panaku', 'ã‚«ãƒŠ': 'kana',
                    'ãƒ‘ãƒ‹ãƒ‘ãƒ‹': 'panipani', 'æ¡œ': 'sakura',
                    
                    // ã‚ã„ã•ã¤  
                    'ã‚„ã': 'na sai', 'ã“ã‚“ã«ã¡ã¯': 'pin ma', 'ãŠã¯ã‚ˆã†': 'pin kai',
                    'ã“ã‚“ã°ã‚“ã¯': 'pin kai', 'ãŠã‚„ã™ã¿': 'na pin kai na tin',
                    'ã•ã‚ˆã†ãªã‚‰': 'pu na sai', 'ã‚ã‚ŠãŒã¨ã†': 'na na kai sai',
                    'ãŒã‚“ã°ã‚Œ': 'na na kin sai', 'å…ƒæ°—': 'sai'
                };

                // é€†ç¿»è¨³è¾æ›¸ã‚’æ§‹ç¯‰
                this.buildReverseDict();
            }

            buildReverseDict() {
                this.panipaniToJa = {};
                
                // åŸºæœ¬èªå½™ã‹ã‚‰
                for (const [ja, pa] of Object.entries(this.japaneseToPs)) {
                    if (!this.panipaniToJa[pa]) {
                        this.panipaniToJa[pa] = [];
                    }
                    this.panipaniToJa[pa].push(ja);
                }

                // ã‚ã„ã•ã¤ã‹ã‚‰
                for (const [pa, ja] of Object.entries(this.greetings)) {
                    const cleanPa = pa.replace(/[!?]/g, '');
                    if (!this.panipaniToJa[cleanPa]) {
                        this.panipaniToJa[cleanPa] = [];
                    }
                    this.panipaniToJa[cleanPa].push(ja.replace(/[!?]/g, ''));
                }

                // è¡¨ç¾ä¾‹ã‹ã‚‰
                for (const [pa, ja] of Object.entries(this.expressions)) {
                    if (!this.panipaniToJa[pa]) {
                        this.panipaniToJa[pa] = [];
                    }
                    this.panipaniToJa[pa].push(ja);
                }
            }

            // æ—¥æœ¬èªã®å‰å‡¦ç†
            preprocessJapanese(text) {
                // å¥èª­ç‚¹é™¤å»
                text = text.replace(/[ã€‚ã€ï¼ï¼Ÿ]/g, '');
                return text.trim();
            }

            // ãƒ‘ãƒ‹ãƒ‘ãƒ‹ã®å‰å‡¦ç†
            preprocessPanipani(text) {
                return text.toLowerCase().replace(/[!?]/g, '').trim();
            }

            // æ—¥æœ¬èªæ–‡ã®æ§‹é€ è§£æ
            analyzeJapaneseSentence(text) {
                const processed = this.preprocessJapanese(text);
                console.log('è§£æå¯¾è±¡:', processed); // ãƒ‡ãƒãƒƒã‚°ç”¨
                
                // ãƒ‘ã‚¿ãƒ¼ãƒ³1: A ã¯ B ã§ã™  
                let match = processed.match(/(.+?)ã¯(.+?)ã§ã™?$/);
                if (match) {
                    console.log('copulaãƒãƒƒãƒ:', match[1], match[2]);
                    return {
                        type: 'copula',
                        subject: match[1].trim(),
                        predicate: match[2].trim()
                    };
                }

                // ãƒ‘ã‚¿ãƒ¼ãƒ³2: A ã¯ B ã—ã¾ã™ ï¼ˆä¿®æ­£ï¼šå‹•è©æ´»ç”¨ã‚‚è€ƒæ…®ï¼‰
                match = processed.match(/(.+?)ã¯(.+?)(ã—ã¾ã™|ã¾ã™)$/);
                if (match) {
                    console.log('verbãƒãƒƒãƒ:', match[1], match[2], match[3]);
                    return {
                        type: 'verb',
                        subject: match[1].trim(),
                        verb: match[2].trim() + match[3] // æ´»ç”¨è¾¼ã¿ã§å‡¦ç†
                    };
                }

                // ãƒ‘ã‚¿ãƒ¼ãƒ³3: A ã¯ C ã‚’ B ã—ã¾ã™
                match = processed.match(/(.+?)ã¯(.+?)ã‚’(.+)/);
                if (match) {
                    console.log('transitiveãƒãƒƒãƒ:', match[1], match[2], match[3]);
                    return {
                        type: 'transitive',
                        subject: match[1].trim(),
                        object: match[2].trim(),
                        verb: match[3].trim()
                    };
                }

                // ãƒ‘ã‚¿ãƒ¼ãƒ³4: å¦å®šæ–‡ã‚’å«ã‚€è¤‡é›‘ãªæ§‹é€ 
                if (processed.includes('ãªã„') || processed.includes('ã¾ã›ã‚“')) {
                    return this.analyzeNegativeSentence(processed);
                }

                // ãã®ä»–ã®ãƒ‘ã‚¿ãƒ¼ãƒ³
                console.log('ãã®ä»–ã®ãƒ‘ã‚¿ãƒ¼ãƒ³');
                return {
                    type: 'other',
                    words: processed.split(/\s+/)
                };
            }

            // å¦å®šæ–‡ã®è§£æ
            analyzeNegativeSentence(text) {
                // ä¾‹: ã¯ãªã¯å¤§ãããªã„
                let match = text.match(/^(.+?)ã¯(.+?)ãªã„$/);
                if (match) {
                    return {
                        type: 'negative_copula',
                        subject: match[1].trim(),
                        predicate: match[2].trim()
                    };
                }

                return {
                    type: 'negative_other',
                    text: text
                };
            }

            // å˜èªç¿»è¨³ï¼ˆä¿®æ­£ç‰ˆï¼‰
            translateWord(word) {
                console.log('å˜èªç¿»è¨³:', word); // ãƒ‡ãƒãƒƒã‚°ç”¨
                
                // ç›´æ¥ãƒãƒƒãƒï¼ˆå®Œå…¨ä¸€è‡´ã‚’å„ªå…ˆï¼‰
                if (this.japaneseToPs[word]) {
                    console.log('ç›´æ¥ãƒãƒƒãƒ:', word, 'â†’', this.japaneseToPs[word]);
                    return this.japaneseToPs[word];
                }

                // å‹•è©æ´»ç”¨å‡¦ç†ï¼ˆã‚ˆã‚Šè©³ç´°ã«ï¼‰
                if (word.endsWith('ã¾ã™')) {
                    const withMasu = word; // ãã®ã¾ã¾ãƒã‚§ãƒƒã‚¯
                    if (this.japaneseToPs[withMasu]) {
                        console.log('ã¾ã™ãƒãƒƒãƒ:', withMasu, 'â†’', this.japaneseToPs[withMasu]);
                        return this.japaneseToPs[withMasu];
                    }
                    
                    const base = word.slice(0, -2);
                    if (this.japaneseToPs[base]) {
                        console.log('æ´»ç”¨ãƒãƒƒãƒ:', base, 'â†’', this.japaneseToPs[base]);
                        return this.japaneseToPs[base];
                    }
                }

                // ã„ã¾ã™å½¢ã®å‡¦ç†
                if (word.endsWith('ã„ã¾ã™')) {
                    const withImasu = word; // ãã®ã¾ã¾ãƒã‚§ãƒƒã‚¯
                    if (this.japaneseToPs[withImasu]) {
                        console.log('ã„ã¾ã™ãƒãƒƒãƒ:', withImasu, 'â†’', this.japaneseToPs[withImasu]);
                        return this.japaneseToPs[withImasu];
                    }
                    
                    const base = word.slice(0, -3);
                    if (this.japaneseToPs[base]) {
                        console.log('ã„ã¾ã™æ´»ç”¨ãƒãƒƒãƒ:', base, 'â†’', this.japaneseToPs[base]);
                        return this.japaneseToPs[base];
                    }
                }

                // å€Ÿç”¨èªã¨ã—ã¦è¿”ã™
                console.log('å€Ÿç”¨èª:', word);
                return word.toLowerCase();
            }

            // ãƒ‘ãƒ‹ãƒ‘ãƒ‹â†’æ—¥æœ¬èªå˜èªç¿»è¨³ï¼ˆä¿®æ­£ç‰ˆï¼‰
            translatePanipaniWord(word) {
                // å›ºæœ‰åè©ã®å„ªå…ˆå‡¦ç†
                const properNouns = {
                    'mika': 'ãƒŸã‚«',
                    'chisa': 'ã¡ã•', 
                    'panaku': 'ã¯ãª',
                    'kana': 'ã‚«ãƒŠ',
                    'panipani': 'ãƒ‘ãƒ‹ãƒ‘ãƒ‹',
                    'sakura': 'æ¡œ'
                };
                
                if (properNouns[word]) {
                    return properNouns[word];
                }
                
                // åŸºæœ¬èªå½™ã®ç¿»è¨³
                if (this.panipaniToJa[word]) {
                    // æ–‡è„ˆã«å¿œã˜ãŸç¿»è¨³é¸æŠ
                    const candidates = this.panipaniToJa[word];
                    
                    // 'na' ã®å ´åˆã¯æ–‡è„ˆã«å¿œã˜ã¦é¸æŠ
                    if (word === 'na') {
                        // é€šå¸¸ã¯ã€Œãã‚Œã€ã‚’å„ªå…ˆï¼ˆä»£æ›¿è¡¨ç¾ã§ä½¿ã‚ã‚Œã‚‹ã“ã¨ãŒå¤šã„ï¼‰
                        return candidates.includes('ãã‚Œ') ? 'ãã‚Œ' : candidates[0];
                    }
                    
                    return candidates[0];
                }
                
                return word;
            }

            // æ—¥æœ¬èªâ†’ãƒ‘ãƒ‹ãƒ‘ãƒ‹ç¿»è¨³ï¼ˆå®Œå…¨æ–‡æ³•å¯¾å¿œãƒ»ä¿®æ­£ç‰ˆï¼‰
            translateToPs(text) {
                if (!text.trim()) return "";

                console.log('ç¿»è¨³é–‹å§‹:', text); // ãƒ‡ãƒãƒƒã‚°ç”¨

                // ã‚ã„ã•ã¤ã®ç›´æ¥ãƒã‚§ãƒƒã‚¯
                for (const [pa, ja] of Object.entries(this.greetings)) {
                    if (text.includes(ja.replace(/[!?]/g, ''))) {
                        console.log('ã‚ã„ã•ã¤ãƒãƒƒãƒ:', pa);
                        return pa;
                    }
                }

                // æ–‡æ§‹é€ è§£æ
                const structure = this.analyzeJapaneseSentence(text);
                console.log('æ–‡æ§‹é€ :', structure); // ãƒ‡ãƒãƒƒã‚°ç”¨

                switch (structure.type) {
                    case 'copula':
                        // A ã¯ B ã§ã™ â†’ A B
                        const subjPs = this.translateWord(structure.subject);
                        const predPs = this.translateWord(structure.predicate);
                        console.log('copula:', subjPs, predPs);
                        return `${subjPs} ${predPs}`;

                    case 'verb':
                        // A ã¯ B ã—ã¾ã™ â†’ A A B ï¼ˆä¿®æ­£ï¼šå‹•è©æ–‡ã¯ä¸»èªã‚’2å›ç¹°ã‚Šè¿”ã™ï¼‰
                        const subjVPs = this.translateWord(structure.subject);
                        const verbPs = this.translateWord(structure.verb);
                        console.log('verb:', subjVPs, subjVPs, verbPs);
                        return `${subjVPs} ${subjVPs} ${verbPs}`;

                    case 'transitive':
                        // A ã¯ C ã‚’ B ã—ã¾ã™ â†’ A na A B. na C
                        const subjTPs = this.translateWord(structure.subject);
                        const objPs = this.translateWord(structure.object);
                        const verbTPs = this.translateWord(structure.verb);
                        console.log('transitive:', subjTPs, objPs, verbTPs);
                        return `${subjTPs} na ${subjTPs} ${verbTPs}. na ${objPs}`;

                    case 'negative_copula':
                        // ã¯ãªã¯å¤§ãããªã„ â†’ pu ni panaku
                        const negSubj = this.translateWord(structure.subject);
                        const negPred = this.translateWord(structure.predicate);
                        console.log('negative:', negSubj, negPred);
                        return `pu ${negPred} ${negSubj}`;

                    default:
                        // ãã®ä»–ã¯å˜èªãƒ™ãƒ¼ã‚¹ç¿»è¨³
                        console.log('ãã®ä»–ã®ç¿»è¨³');
                        const words = text.replace(/[ã¯ã‚’ã«]/g, ' ').split(/\s+/).filter(w => w);
                        const result = words.map(w => this.translateWord(w)).join(' ');
                        console.log('å˜èªãƒ™ãƒ¼ã‚¹çµæœ:', result);
                        return result;
                }
            }

            // ãƒ‘ãƒ‹ãƒ‘ãƒ‹â†’æ—¥æœ¬èªç¿»è¨³ï¼ˆå®Œå…¨æ–‡æ³•å¯¾å¿œãƒ»ä¿®æ­£ç‰ˆï¼‰
            translateFromPs(text) {
                if (!text.trim()) return "";

                const processed = this.preprocessPanipani(text);

                // ã‚ã„ã•ã¤ã®ç›´æ¥ãƒã‚§ãƒƒã‚¯
                for (const [pa, ja] of Object.entries(this.greetings)) {
                    const cleanPa = this.preprocessPanipani(pa);
                    if (processed === cleanPa) {
                        return ja;
                    }
                }

                // è¡¨ç¾ä¾‹ã®ç›´æ¥ãƒã‚§ãƒƒã‚¯
                if (this.expressions[processed]) {
                    return this.expressions[processed];
                }

                // è¤‡æ–‡ã®å‡¦ç†ï¼ˆ. ã§åŒºåˆ‡ã‚‰ã‚ŒãŸæ–‡ï¼‰
                if (processed.includes('.')) {
                    return this.translateComplexSentence(processed);
                }

                // æ–‡æ§‹é€ ã®è§£æã¨ç¿»è¨³
                return this.analyzePanipaniStructure(processed);
            }

            // è¤‡æ–‡ç¿»è¨³å‡¦ç†
            translateComplexSentence(text) {
                const sentences = text.split('.').map(s => s.trim()).filter(s => s);
                
                if (sentences.length === 2) {
                    const first = sentences[0];
                    const second = sentences[1];
                    
                    // A na A B. na C ãƒ‘ã‚¿ãƒ¼ãƒ³ã®å‡¦ç†
                    const firstWords = first.split(/\s+/);
                    const secondWords = second.split(/\s+/);
                    
                    if (firstWords.length === 4 && firstWords[1] === 'na' && 
                        firstWords[0] === firstWords[2] && 
                        secondWords.length >= 2 && secondWords[0] === 'na') {
                        
                        const subject = this.translatePanipaniWord(firstWords[0]);
                        const verb = this.translatePanipaniWord(firstWords[3]);
                        const object = secondWords.slice(1).map(w => this.translatePanipaniWord(w)).join('');
                        
                        return `${subject}ã¯${object}ã‚’${verb}ã—ã¾ã™`;
                    }
                }
                
                // ãã®ä»–ã®è¤‡æ–‡ã¯å€‹åˆ¥ã«ç¿»è¨³ã—ã¦çµåˆ
                return sentences.map(s => this.analyzePanipaniStructure(s)).join('ã€‚');
            }

            // ãƒ‘ãƒ‹ãƒ‘ãƒ‹æ–‡æ§‹é€ è§£æ
            analyzePanipaniStructure(text) {
                const words = text.split(/\s+/).filter(w => w);

                // ãƒ‘ã‚¿ãƒ¼ãƒ³1: pu pu ã§å§‹ã¾ã‚‹ç–‘å•æ–‡
                if (words[0] === 'pu' && words[1] === 'pu') {
                    const content = words.slice(2).map(w => this.translatePanipaniWord(w)).join('');
                    return `${content}ã§ã™ã‹ï¼Ÿ`;
                }

                // ãƒ‘ã‚¿ãƒ¼ãƒ³2: å¦å®šæ–‡ pu + èª
                if (words[0] === 'pu') {
                    if (words.length === 3) {
                        // pu ni panaku â†’ ã¯ãªã¯å¤§ãããªã„
                        const adj = this.translatePanipaniWord(words[1]);
                        const subj = this.translatePanipaniWord(words[2]);
                        return `${subj}ã¯${adj}ããªã„`;
                    } else if (words.length === 4) {
                        // pu pa kana kana â†’ ã‚«ãƒŠã¯è©±ã•ãªã„
                        const verb = this.translatePanipaniWord(words[1]);
                        const subj = this.translatePanipaniWord(words[2]);
                        return `${subj}ã¯${verb}ã•ãªã„`;
                    }
                }

                // ãƒ‘ã‚¿ãƒ¼ãƒ³3: A A B ï¼ˆå‹•è©æ–‡)
                if (words.length === 3 && words[0] === words[1]) {
                    const subj = this.translatePanipaniWord(words[0]);
                    const verb = this.translatePanipaniWord(words[2]);
                    return `${subj}ã¯${verb}ã—ã¾ã™`;
                }

                // ãƒ‘ã‚¿ãƒ¼ãƒ³4: A B ï¼ˆåè©æ–‡ï¼‰
                if (words.length === 2) {
                    const first = this.translatePanipaniWord(words[0]);
                    const second = this.translatePanipaniWord(words[1]);
                    return `${first}ã¯${second}ã§ã™`;
                }

                // ãƒ‘ã‚¿ãƒ¼ãƒ³5: A na A B å½¢å¼ï¼ˆä»£æ›¿è¡¨ç¾ã®ç¬¬1æ–‡ï¼‰
                if (words.length === 4 && words[1] === 'na' && words[0] === words[2]) {
                    const subj = this.translatePanipaniWord(words[0]);
                    const verb = this.translatePanipaniWord(words[3]);
                    return `${subj}ã¯ãã‚Œã‚’${verb}ã—ã¾ã™`;
                }

                // ãƒ‘ã‚¿ãƒ¼ãƒ³6: na + èªï¼ˆä»£æ›¿è¡¨ç¾ã®ç¬¬2æ–‡ï¼‰
                if (words.length >= 2 && words[0] === 'na') {
                    const obj = words.slice(1).map(w => this.translatePanipaniWord(w)).join('');
                    return `ãã‚Œã¯${obj}ã§ã™`;
                }

                // ãƒ‘ã‚¿ãƒ¼ãƒ³7: ta ã‚’å«ã‚€ç–‘å•æ–‡
                if (words.includes('ta')) {
                    const result = words.map(w => {
                        if (w === 'ta') return 'ä½•';
                        return this.translatePanipaniWord(w);
                    }).join('');
                    return `${result}ã§ã™ã‹ï¼Ÿ`;
                }

                // ãƒ‘ã‚¿ãƒ¼ãƒ³8: å‰ç½®è©ä»˜ã
                if (words[0] === 'nui') {
                    const prep = `nui ${words[1]}`;
                    if (this.prepositions[prep]) {
                        const meaning = this.prepositions[prep];
                        const rest = words.slice(2).map(w => this.translatePanipaniWord(w)).join('');
                        return `${meaning}${rest}`;
                    }
                }

                // ãƒ‘ã‚¿ãƒ¼ãƒ³9: ãã®ä»–ã®å˜èªåˆ—
                return words.map(w => this.translatePanipaniWord(w)).join('');
            }

            // ç¿»è¨³åˆ†æï¼ˆä¿®æ­£ç‰ˆï¼‰
            analyzeTranslation(input, isReverse = false) {
                const analysis = [];
                
                if (isReverse) {
                    // ãƒ‘ãƒ‹ãƒ‘ãƒ‹â†’æ—¥æœ¬èªã®åˆ†æ
                    if (input.includes('.')) {
                        analysis.push('æ–‡å‹: è¤‡æ–‡ï¼ˆA na A B. na Cå½¢å¼ï¼‰');
                        const sentences = input.split('.').map(s => s.trim()).filter(s => s);
                        sentences.forEach((sentence, i) => {
                            const words = sentence.split(/\s+/).filter(w => w);
                            analysis.push(`ç¬¬${i+1}æ–‡: ${words.map(w => `'${w}'`).join(' ')}`);
                            words.forEach(word => {
                                const translated = this.translatePanipaniWord(word);
                                const meaning = this.vocabulary[word] || "å›ºæœ‰åè©ãƒ»è¡¨ç¾";
                                analysis.push(`  '${word}' â†’ '${translated}' (${meaning})`);
                            });
                        });
                    } else {
                        const words = this.preprocessPanipani(input).split(/\s+/).filter(w => w);
                        for (const word of words) {
                            const translated = this.translatePanipaniWord(word);
                            const meaning = this.vocabulary[word] || "å›ºæœ‰åè©ãƒ»è¡¨ç¾";
                            analysis.push(`'${word}' â†’ '${translated}' (${meaning})`);
                        }
                    }
                } else {
                    // æ—¥æœ¬èªâ†’ãƒ‘ãƒ‹ãƒ‘ãƒ‹ã®åˆ†æ
                    const structure = this.analyzeJapaneseSentence(input);
                    analysis.push(`æ–‡å‹: ${this.getStructureDescription(structure.type)}`);
                    
                    if (structure.subject) {
                        const subjPs = this.translateWord(structure.subject);
                        analysis.push(`ä¸»èª: '${structure.subject}' â†’ '${subjPs}'`);
                    }
                    if (structure.predicate) {
                        const predPs = this.translateWord(structure.predicate);
                        analysis.push(`è¿°èª: '${structure.predicate}' â†’ '${predPs}'`);
                    }
                    if (structure.verb) {
                        const verbPs = this.translateWord(structure.verb);
                        analysis.push(`å‹•è©: '${structure.verb}' â†’ '${verbPs}'`);
                    }
                    if (structure.object) {
                        const objPs = this.translateWord(structure.object);
                        analysis.push(`ç›®çš„èª: '${structure.object}' â†’ '${objPs}'`);
                    }
                }
                
                return analysis;
            }

            // æ–‡æ§‹é€ ã®èª¬æ˜
            getStructureDescription(type) {
                const descriptions = {
                    'copula': 'A ã¯ B ã§ã™ï¼ˆåè©æ–‡ï¼‰',
                    'verb': 'A ã¯ B ã—ã¾ã™ï¼ˆå‹•è©æ–‡ï¼‰â†’ A A B',
                    'transitive': 'A ã¯ C ã‚’ B ã—ã¾ã™ï¼ˆä»–å‹•è©æ–‡ï¼‰',
                    'negative_copula': 'å¦å®šæ–‡ï¼ˆå½¢å®¹è©ï¼‰',
                    'negative_other': 'å¦å®šæ–‡ï¼ˆãã®ä»–ï¼‰',
                    'other': 'ãã®ä»–ã®æ–‡å‹'
                };
                return descriptions[type] || 'ä¸æ˜ãªæ–‡å‹';
            }
        }

        // ã‚¢ãƒ—ãƒªåˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function() {
            const engine = new PaniPaniGrammarEngine();
            let isReverse = false;
            
            // DOMè¦ç´ ã®å–å¾—
            const modeJaToPa = document.getElementById('modeJaToPa');
            const modePaToJa = document.getElementById('modePaToJa');
            const modeText = document.getElementById('modeText');
            const exampleText = document.getElementById('exampleText');
            const inputLabel = document.getElementById('inputLabel');
            const outputLabel = document.getElementById('outputLabel');
            const inputText = document.getElementById('inputText');
            const output = document.getElementById('output');
            const analysisOutput = document.getElementById('analysisOutput');
            const translateBtn = document.getElementById('translateBtn');
            const clearBtn = document.getElementById('clearBtn');
            const vocabBtn = document.getElementById('vocabBtn');
            const phrasesBtn = document.getElementById('phrasesBtn');
            
            // ãƒ¢ãƒ¼ãƒ€ãƒ«é–¢é€£
            const vocabModal = document.getElementById('vocabModal');
            const phrasesModal = document.getElementById('phrasesModal');
            const vocabList = document.getElementById('vocabList');
            const greetingsList = document.getElementById('greetingsList');
            const expressionsList = document.getElementById('expressionsList');
            const prepositionsList = document.getElementById('prepositionsList');
            
            // èªå½™è¡¨ã®è¨­å®š
            const vocabItems = Object.entries(engine.vocabulary)
                .map(([word, meaning]) => 
                    `<div class="vocab-item"><strong>${word}</strong>: ${meaning}</div>`
                ).join('');
            vocabList.innerHTML = vocabItems;

            // ã‚ã„ã•ã¤ãƒ»æ…£ç”¨å¥ã®è¨­å®š
            const greetingsItems = Object.entries(engine.greetings)
                .map(([panipani, japanese]) => 
                    `<div class="phrase-item">
                        <div class="phrase-panipani">${panipani}</div>
                        <div class="phrase-meaning">${japanese}</div>
                    </div>`
                ).join('');
            greetingsList.innerHTML = greetingsItems;

            const expressionsItems = Object.entries(engine.expressions)
                .map(([panipani, japanese]) => 
                    `<div class="phrase-item">
                        <div class="phrase-panipani">${panipani}</div>
                        <div class="phrase-meaning">${japanese}</div>
                    </div>`
                ).join('');
            expressionsList.innerHTML = expressionsItems;

            const prepositionsItems = Object.entries(engine.prepositions)
                .map(([panipani, japanese]) => 
                    `<div class="phrase-item">
                        <div class="phrase-panipani">${panipani}</div>
                        <div class="phrase-meaning">${japanese}</div>
                    </div>`
                ).join('');
            prepositionsList.innerHTML = prepositionsItems;

            // ä¾‹æ–‡ã‚»ãƒƒãƒˆ
            const examples = {
                ja: [
                    'ã‚ã‚Œã¯æ¡œã§ã™',
                    'ã¡ã•ã¯è¡Œãã¾ã™', 
                    'ãƒŸã‚«ã¯ãƒ‘ãƒ‹ãƒ‘ãƒ‹ã‚’ä½¿ã„ã¾ã™',
                    'ã¯ãªã¯å¤§ãããªã„',
                    'ã‚„ãï¼'
                ],
                pa: [
                    'na sakura',
                    'chisa chisa kai',
                    'mika na mika sin. na panipani',
                    'pu ni panaku',
                    'na sai'
                ]
            };

            let currentExampleIndex = 0;

            // UIã‚’æ›´æ–°ã™ã‚‹é–¢æ•°
            function updateUI() {
                if (isReverse) {
                    // ãƒ‘ãƒ‹ãƒ‘ãƒ‹â†’æ—¥æœ¬èªãƒ¢ãƒ¼ãƒ‰
                    modeJaToPa.classList.remove('active');
                    modePaToJa.classList.add('active');
                    modeText.textContent = 'ãƒ‘ãƒ‹ãƒ‘ãƒ‹èª â†’ æ—¥æœ¬èª';
                    inputLabel.textContent = 'ğŸŒ¸ ãƒ‘ãƒ‹ãƒ‘ãƒ‹èªã‚’å…¥åŠ›:';
                    outputLabel.textContent = 'ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª:';
                    inputText.placeholder = 'ä¾‹: na sakura';
                    exampleText.textContent = examples.pa[currentExampleIndex];
                } else {
                    // æ—¥æœ¬èªâ†’ãƒ‘ãƒ‹ãƒ‘ãƒ‹ãƒ¢ãƒ¼ãƒ‰
                    modeJaToPa.classList.add('active');
                    modePaToJa.classList.remove('active');
                    modeText.textContent = 'æ—¥æœ¬èª â†’ ãƒ‘ãƒ‹ãƒ‘ãƒ‹èª';
                    inputLabel.textContent = 'ğŸ‡¯ğŸ‡µ æ—¥æœ¬èªã‚’å…¥åŠ›:';
                    outputLabel.textContent = 'ğŸŒŸ ãƒ‘ãƒ‹ãƒ‘ãƒ‹èª:';
                    inputText.placeholder = 'ä¾‹: ã‚ã‚Œã¯æ¡œã§ã™';
                    exampleText.textContent = examples.ja[currentExampleIndex];
                }
            }
            
            // ç¿»è¨³æ©Ÿèƒ½
            function translate() {
                const input = inputText.value.trim();
                if (!input) {
                    alert('ãƒ†ã‚­ã‚¹ãƒˆã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                    return;
                }
                
                try {
                    let result, analysis;
                    if (isReverse) {
                        // ãƒ‘ãƒ‹ãƒ‘ãƒ‹â†’æ—¥æœ¬èª
                        result = engine.translateFromPs(input);
                        analysis = engine.analyzeTranslation(input, true);
                    } else {
                        // æ—¥æœ¬èªâ†’ãƒ‘ãƒ‹ãƒ‘ãƒ‹
                        result = engine.translateToPs(input);
                        analysis = engine.analyzeTranslation(input, false);
                    }
                    
                    output.textContent = result;
                    output.classList.remove('empty');
                    analysisOutput.innerHTML = analysis.join('<br>');
                    
                    // æˆåŠŸæ™‚ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
                    output.style.animation = 'none';
                    setTimeout(() => {
                        output.style.animation = 'bounce 0.5s ease';
                    }, 10);
                    
                } catch (error) {
                    console.error('ç¿»è¨³ã‚¨ãƒ©ãƒ¼:', error);
                    output.textContent = 'ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ';
                    analysisOutput.textContent = 'ã‚¨ãƒ©ãƒ¼: ' + error.message;
                }
            }
            
            // ã‚¯ãƒªã‚¢æ©Ÿèƒ½
            function clearAll() {
                inputText.value = '';
                output.textContent = 'ã“ã“ã«ç¿»è¨³çµæœãŒè¡¨ç¤ºã•ã‚Œã¾ã™';
                output.classList.add('empty');
                analysisOutput.textContent = '';
            }
            
            // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
            modeJaToPa.addEventListener('click', () => {
                isReverse = false;
                updateUI();
                clearAll();
            });

            modePaToJa.addEventListener('click', () => {
                isReverse = true;
                updateUI();
                clearAll();
            });

            translateBtn.addEventListener('click', translate);
            clearBtn.addEventListener('click', clearAll);
            
            // Enterã‚­ãƒ¼ã§ç¿»è¨³
            inputText.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    translate();
                }
            });
            
            // èªå½™è¡¨ãƒ¢ãƒ¼ãƒ€ãƒ«
            vocabBtn.addEventListener('click', function() {
                vocabModal.classList.add('show');
            });

            // ã‚ã„ã•ã¤ãƒ¢ãƒ¼ãƒ€ãƒ«
            phrasesBtn.addEventListener('click', function() {
                phrasesModal.classList.add('show');
            });
            
            // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚¯ãƒ­ãƒ¼ã‚º
            document.getElementById('closeVocabModal').addEventListener('click', function() {
                vocabModal.classList.remove('show');
            });

            document.getElementById('closePhrasesModal').addEventListener('click', function() {
                phrasesModal.classList.remove('show');
            });
            
            // ãƒ¢ãƒ¼ãƒ€ãƒ«å¤–ã‚¯ãƒªãƒƒã‚¯ã§é–‰ã˜ã‚‹
            [vocabModal, phrasesModal].forEach(modal => {
                modal.addEventListener('click', function(e) {
                    if (e.target === modal) {
                        modal.classList.remove('show');
                    }
                });
            });

            // ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆæ©Ÿèƒ½
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const targetTab = this.dataset.tab;
                    
                    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                    
                    this.classList.add('active');
                    document.getElementById(targetTab).classList.add('active');
                });
            });

            // ä¾‹æ–‡ã‚¯ãƒªãƒƒã‚¯ã§è‡ªå‹•å…¥åŠ›ï¼†ç¿»è¨³
            exampleText.addEventListener('click', function() {
                inputText.value = exampleText.textContent;
                translate();
                
                // æ¬¡ã®ä¾‹æ–‡ã«æ›´æ–°
                currentExampleIndex = (currentExampleIndex + 1) % examples.ja.length;
                setTimeout(() => updateUI(), 1000);
            });

            // ãƒ•ãƒ¬ãƒ¼ã‚ºã‚¯ãƒªãƒƒã‚¯ã§è‡ªå‹•å…¥åŠ›
            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('phrase-panipani')) {
                    const phraseText = e.target.textContent;
                    if (isReverse) {
                        inputText.value = phraseText;
                    } else {
                        const meaningElement = e.target.nextElementSibling;
                        if (meaningElement) {
                            inputText.value = meaningElement.textContent.replace(/[!?]/g, '');
                        }
                    }
                    
                    phrasesModal.classList.remove('show');
                    translate();
                }
            });

            // åˆæœŸUIè¨­å®š
            updateUI();
        });

        // CSS Animationè¿½åŠ 
        const style = document.createElement('style');
        style.textContent = `
            @keyframes bounce {
                0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
                40% { transform: translateY(-10px); }
                60% { transform: translateY(-5px); }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>
