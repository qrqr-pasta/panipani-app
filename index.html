<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>„Éë„Éã„Éë„ÉãÁøªË®≥„Ç¢„Éó„É™ v4.0</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="„Éë„Éã„Éë„Éã">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', 'Hiragino Kaku Gothic ProN', 'Hiragino Sans', Meiryo, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 10px;
        }

        .container {
            max-width: 500px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .header {
            text-align: center;
            margin-bottom: 20px;
        }

        .title {
            color: #333;
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .version {
            background: linear-gradient(135deg, #e74c3c 0%, #f39c12 100%);
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
            display: inline-block;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #666;
            font-size: 14px;
        }

        .translation-mode {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 20px;
            text-align: center;
        }

        .mode-switch {
            display: flex;
            background: #e9ecef;
            border-radius: 25px;
            padding: 4px;
            margin-bottom: 10px;
        }

        .mode-btn {
            flex: 1;
            padding: 8px 16px;
            border: none;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            background: transparent;
            color: #666;
        }

        .mode-btn.active {
            background: #667eea;
            color: white;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
        }

        .mode-description {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }

        .input-group {
            margin-bottom: 15px;
        }

        .label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #555;
        }

        .text-input {
            width: 100%;
            min-height: 80px;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 16px;
            font-family: inherit;
            resize: vertical;
            transition: all 0.3s;
        }

        .text-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .button-group {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .btn {
            flex: 1;
            min-width: 80px;
            padding: 12px 16px;
            border: none;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-family: inherit;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #f8f9fa;
            color: #667eea;
            border: 2px solid #667eea;
        }

        .btn-secondary:hover {
            background: #667eea;
            color: white;
        }

        .btn-success {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
        }

        .output {
            background: linear-gradient(135deg, #e8f4f8 0%, #f0f8ff 100%);
            border-radius: 10px;
            padding: 15px;
            min-height: 60px;
            margin-bottom: 15px;
            font-size: 18px;
            font-weight: 500;
            color: #2c3e50;
            border-left: 4px solid #667eea;
        }

        .output.empty {
            color: #999;
            font-style: italic;
        }

        .analysis {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            min-height: 80px;
            font-size: 14px;
            color: #666;
            line-height: 1.6;
            border: 1px solid #e9ecef;
            max-height: 200px;
            overflow-y: auto;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
        }

        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            border-radius: 15px;
            padding: 20px;
            max-width: 90%;
            max-height: 80%;
            overflow-y: auto;
        }

        .modal-title {
            text-align: center;
            margin-bottom: 15px;
            font-size: 18px;
            font-weight: bold;
            color: #333;
        }

        .vocab-item {
            padding: 8px;
            margin: 4px 0;
            background: #f8f9fa;
            border-radius: 5px;
            border-left: 3px solid #667eea;
        }

        .phrase-item {
            padding: 10px;
            margin: 6px 0;
            background: #e8f5e8;
            border-radius: 5px;
            border-left: 3px solid #28a745;
            cursor: pointer;
        }

        .phrase-item:hover {
            background: #d4edda;
        }

        .phrase-panipani {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 3px;
        }

        .phrase-meaning {
            font-size: 13px;
            color: #666;
        }

        .example-section {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 10px;
            margin-bottom: 15px;
        }

        .example-title {
            font-weight: bold;
            color: #856404;
            margin-bottom: 5px;
            font-size: 12px;
        }

        .example-text {
            font-size: 13px;
            color: #856404;
            cursor: pointer;
        }

        .example-text:hover {
            text-decoration: underline;
        }

        .tab-buttons {
            display: flex;
            background: #f8f9fa;
            border-radius: 10px;
            padding: 4px;
            margin-bottom: 15px;
        }

        .tab-btn {
            flex: 1;
            padding: 8px 12px;
            border: none;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            background: transparent;
            color: #666;
        }

        .tab-btn.active {
            background: white;
            color: #333;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        @media (max-width: 480px) {
            .container {
                margin: 5px;
                padding: 15px;
                border-radius: 15px;
            }
            
            .button-group {
                flex-direction: column;
            }
            
            .btn {
                flex: none;
                margin: 2px 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 class="title">üå∏ „Éë„Éã„Éë„ÉãÁøªË®≥„Ç¢„Éó„É™ üå∏</h1>
            <div class="version">v4.0 ÂÆåÂÖ®ÊñáÊ≥ïÊ∫ñÊã†</div>
            <p class="subtitle">17Ë™û„ÅÆ‰∫∫Â∑•Ë®ÄË™û„Éë„Éã„Éë„Éã„ÅÆÂÆåÂÖ®ÊñáÊ≥ï„Ç®„É≥„Ç∏„É≥</p>
        </div>
        
        <!-- ÁøªË®≥„É¢„Éº„ÉâÂàá„ÇäÊõø„Åà -->
        <div class="translation-mode">
            <div class="mode-switch">
                <button id="modeJaToPa" class="mode-btn active">üáØüáµ‚Üíüå∏</button>
                <button id="modePaToJa" class="mode-btn">üå∏‚ÜíüáØüáµ</button>
            </div>
            <div id="modeText" class="mode-description">Êó•Êú¨Ë™û ‚Üí „Éë„Éã„Éë„ÉãË™û</div>
        </div>

        <!-- ‰æãÊñáË°®Á§∫ -->
        <div id="exampleSection" class="example-section">
            <div class="example-title">üí° ‰æãÊñá:</div>
            <div id="exampleText" class="example-text">„ÅÇ„Çå„ÅØÊ°ú„Åß„Åô</div>
        </div>
        
        <div class="input-group">
            <label id="inputLabel" class="label">üáØüáµ Êó•Êú¨Ë™û„ÇíÂÖ•Âäõ:</label>
            <textarea 
                id="inputText" 
                class="text-input" 
                placeholder="‰æã: „ÅÇ„Çå„ÅØÊ°ú„Åß„Åô"
                rows="3"
            ></textarea>
        </div>
        
        <div class="button-group">
            <button id="translateBtn" class="btn btn-primary">üîÑ ÁøªË®≥</button>
            <button id="clearBtn" class="btn btn-secondary">üóëÔ∏è „ÇØ„É™„Ç¢</button>
            <button id="vocabBtn" class="btn btn-secondary">üìö Ë™ûÂΩôË°®</button>
            <button id="phrasesBtn" class="btn btn-success">üí¨ „ÅÇ„ÅÑ„Åï„Å§</button>
        </div>
        
        <div class="input-group">
            <label id="outputLabel" class="label">üåü „Éë„Éã„Éë„ÉãË™û:</label>
            <div id="output" class="output empty">„Åì„Åì„Å´ÁøªË®≥ÁµêÊûú„ÅåË°®Á§∫„Åï„Çå„Åæ„Åô</div>
        </div>
        
        <div class="input-group">
            <label class="label">üîç ÁøªË®≥ÂàÜÊûê:</label>
            <div id="analysisOutput" class="analysis"></div>
        </div>
    </div>

    <!-- Ë™ûÂΩôË°®„É¢„Éº„ÉÄ„É´ -->
    <div id="vocabModal" class="modal">
        <div class="modal-content">
            <div class="modal-title">üìö „Éë„Éã„Éë„ÉãË™ûÂΩôË°® (17Ë™û)</div>
            <div id="vocabList"></div>
            <button id="closeVocabModal" class="btn btn-secondary" style="width: 100%; margin-top: 15px;">Èñâ„Åò„Çã</button>
        </div>
    </div>

    <!-- „ÅÇ„ÅÑ„Åï„Å§„ÉªÊÖ£Áî®Âè•„É¢„Éº„ÉÄ„É´ -->
    <div id="phrasesModal" class="modal">
        <div class="modal-content">
            <div class="modal-title">üí¨ „ÅÇ„ÅÑ„Åï„Å§„ÉªÊÖ£Áî®Âè•ÈõÜ</div>
            
            <div class="tab-buttons">
                <button class="tab-btn active" data-tab="greetings">„ÅÇ„ÅÑ„Åï„Å§</button>
                <button class="tab-btn" data-tab="expressions">Ë°®Áèæ</button>
                <button class="tab-btn" data-tab="prepositions">ÂâçÁΩÆË©û</button>
            </div>

            <div id="greetings" class="tab-content active">
                <div id="greetingsList"></div>
            </div>

            <div id="expressions" class="tab-content">
                <div id="expressionsList"></div>
            </div>

            <div id="prepositions" class="tab-content">
                <div id="prepositionsList"></div>
            </div>
            
            <button id="closePhrasesModal" class="btn btn-secondary" style="width: 100%; margin-top: 15px;">Èñâ„Åò„Çã</button>
        </div>
    </div>

    <script>
        // „Éë„Éã„Éë„ÉãÂÆåÂÖ®ÊñáÊ≥ï„Ç®„É≥„Ç∏„É≥ v4.0 (‰øÆÊ≠£Áâà)
        class PaniPaniGrammarEngine {
            constructor() {
                // „Éë„Éã„Éë„Éã„ÅÆ17„ÅÆË™ûÂΩôÔºàÂÖ¨ÂºèÁâàÔºâ
                this.vocabulary = {
                    'kai': 'Ë°å„Åè„ÄÅÊù•„Çã„ÄÅÊ≠©„Åè„ÄÅÂãï„Åè„ÄÅÂ§â„Çè„Çã',
                    'kin': 'Âæó„Çã„ÄÅÈ£ü„Åπ„Çã„ÄÅÈ£≤„ÇÄ',
                    'ma': '„ÅÑ„Çã„ÄÅ„ÅÇ„Çã„ÄÅÁîü„Åç„Å¶„ÅÑ„Çã',
                    'mai': 'ÁîüÁâ©',
                    'na': 'ÁßÅ„ÄÅ„ÅÇ„Å™„Åü„ÄÅ„ÅÇ„ÅÆ‰∫∫Ôºà„Åü„Å°Ôºâ„ÄÅ„Åì„Çå„ÄÅ„Åù„Çå„ÄÅ„ÅÇ„Çå',
                    'ni': 'Â§ß„Åç„ÅÑ„ÄÅÈ´ò„ÅÑ„ÄÅÂ§ö„ÅÑ„ÄÅ„Åü„Åè„Åï„Çì„ÄÅ„Å®„Å¶„ÇÇ„ÄÅÊàêÈï∑„Åô„Çã',
                    'nui': 'ÂâçÁΩÆË©ûÂåñ',
                    'pa': 'Ë®Ä„ÅÜ„ÄÅË©±„Åô„ÄÅËÅû„Åè„ÄÅÊõ∏„Åè„ÄÅÊèè„Åè„ÄÅË¶ã„Çã„ÄÅË™≠„ÇÄ„ÄÅÈÄÅ‰ø°„Åô„Çã„ÄÅÂèó‰ø°„Åô„Çã„ÄÅÊÑü„Åò„Çã„ÄÅÂà∫ÊøÄ„Åô„Çã„ÄÅÂà∫ÊøÄ„ÇíÂèó„Åë„Çã„ÄÅ„Åì„Å®„Å∞„ÄÅË®ÄË™û„ÄÅÈü≥„ÄÅÈü≥Ê•Ω„ÄÅÊñáÂ≠ó„ÄÅÂΩ¢„ÄÅÁµµ„ÄÅÂÜôÁúü„ÄÅÂà∫ÊøÄ',
                    'pai': 'ËªΩ„ÅÑ„ÄÅËªΩ„Åï„ÄÅÁ∞°Âçò„ÄÅÁ∞°Âçò„Å™„Åì„Å®',
                    'pin': 'Êòé„Çã„ÅÑ„ÄÅÊòé„Çã„Åï„ÄÅÂÖâ„ÄÅËâ≤',
                    'pu': 'ÔΩû„Åß„ÅØ„Å™„ÅÑ„ÄÅÔΩû„Åó„Å™„ÅÑ',
                    'ru': 'Â†¥ÊâÄ„ÄÅ„Å®„Åì„Çç„ÄÅÊôÇÈñì„ÄÅ„Å®„Åç',
                    'sa': 'Áü•„Çã„ÄÅ„Çè„Åã„Çã„ÄÅÁü•„Çâ„Çå„Å¶„ÅÑ„Çã„ÄÅÁü•Ë≠ò„ÄÅÁøí„ÅÜ„ÄÅÊïô„Çè„Çã„ÄÅËÄÉ„Åà„Çã„ÄÅËÄÉ„Åà',
                    'sai': '„Çà„ÅÑ„ÄÅ„Çà„ÅÑ„Åì„Å®„ÄÅÊ•Ω„Åó„ÅÑ„ÄÅÊ•Ω„Åó„ÇÄ„ÄÅÊ•Ω„Åó„Åï„ÄÅÁæé„Åó„ÅÑ„ÄÅÁæé„Åó„Åï',
                    'sin': '‰Ωø„ÅÜ„ÄÅ‰ΩøÁî®',
                    'ta': '‰Ωï„ÄÅË™∞',
                    'tin': '„Åô„Çã„ÄÅ„Å§„Åè„Çã'
                };

                // „ÅÇ„ÅÑ„Åï„Å§„ÉªÊÖ£Áî®Âè•ÔºàÂÖ¨ÂºèÔºâ
                this.greetings = {
                    'na sai!': '„ÇÑ„ÅÅÔºÅ',
                    'sai!': '„ÇÑ„ÅÅÔºÅ',
                    'pu pu na sai?': 'ÂÖÉÊ∞óÔºü',
                    'pin kai': '„Åä„ÅØ„Çà„ÅÜ„Éª„Åì„Çì„Å∞„Çì„ÅØ',
                    'pin ma': '„Åì„Çì„Å´„Å°„ÅØ',
                    'na pin kai na tin': '„Åä„ÇÑ„Åô„Åø',
                    'na pin kai na tin sai': '„Åä„ÇÑ„Åô„ÅøÔºàÈüª„ÅÇ„ÇäÔºâ',
                    'pu na sai': '„Åï„Çà„ÅÜ„Å™„Çâ',
                    'na sai': '„Åï„Çà„ÅÜ„Å™„Çâ',
                    'na na kai sai!': '„ÅÇ„Çä„Åå„Å®„ÅÜÔºÅ',
                    'na na kin sai!': '„Åå„Çì„Å∞„ÇåÔºÅ„Éª„ÅÇ„Çä„Åå„Å®„ÅÜÔºÅ',
                    'kin sai!': '„Åå„Çì„Å∞„ÇåÔºÅ'
                };

                // ÂâçÁΩÆË©ûÔºàÂÖ¨ÂºèÔºâ
                this.prepositions = {
                    'nui kai': 'ÔΩû„Å´„ÄÅÔΩû„Å∏„ÄÅÔΩû„ÅÆ„Åü„ÇÅ„Å´',
                    'nui kin': 'ÔΩû„Åã„Çâ',
                    'nui ru': 'ÔΩûÔºà„Å®„ÅÑ„ÅÜÂ†¥ÊâÄÔºâ„Åß„ÄÅÔΩûÔºà„ÅÑ„Å§Ôºâ„Å´',
                    'nui sin': 'ÔΩû„Çí‰Ωø„Å£„Å¶'
                };

                // Ë°®Áèæ‰æãÔºàÂÖ¨ÂºèÔºâ
                this.expressions = {
                    'mai sai': '„Çà„ÅÑÁîüÁâ©„ÉªÁæé„Åó„ÅÑÁîüÁâ©',
                    'sai mai': '„Çà„ÅÑÁîüÁâ©„ÉªÁæé„Åó„ÅÑÁîüÁâ©',
                    'pu pin ru': 'Êöó„ÅÑ„Å®„Åì„Çç',
                    'ru pu pin': 'Êöó„ÅÑ„Å®„Åì„Çç',
                    'ru sa': 'Â≠¶Ê†°ÔºàÂ≠¶„Å∂Â†¥ÊâÄÔºâ',
                    'sa ru': 'Â≠¶Ê†°ÔºàÂ≠¶„Å∂Â†¥ÊâÄÔºâ',
                    'na pai na sai': 'Á∞°Âçò„Å™„ÅÆ„ÅåËâØ„ÅÑ„Åì„Å®',
                    'pu pu': 'ÁñëÂïèÊñá„ÅÆÂç∞ÔºàÊñáÈ†≠„Å´ÁΩÆ„ÅèÔºâ'
                };

                // Âü∫Êú¨Ë™ûÂΩô„ÅÆÊó•Êú¨Ë™û‚Üí„Éë„Éã„Éë„ÉãËæûÊõ∏Ôºà‰øÆÊ≠£ÁâàÔºâ
                this.japaneseToPs = {
                    // ‰ª£ÂêçË©û
                    'ÁßÅ': 'na', '„ÅÇ„Å™„Åü': 'na', 'ÂΩº': 'na', 'ÂΩºÂ•≥': 'na',
                    '„Åì„Çå': 'na', '„Åù„Çå': 'na', '„ÅÇ„Çå': 'na', 'Ë™∞': 'ta', '‰Ωï': 'ta',
                    
                    // ÂãïË©ûÔºàÂü∫Êú¨ÂΩ¢„Å®Ê¥ªÁî®ÂΩ¢„ÇíÊòéÁ¢∫„Å´ÂàÜ„Åë„Å¶ÂÆöÁæ©Ôºâ
                    'Ë°å„Åè': 'kai', 'Ë°å„Åç': 'kai', 'Ë°å„Åç„Åæ„Åô': 'kai', 'Ë°å„Å£„Åü': 'kai',
                    'Êù•„Çã': 'kai', 'Êù•„Åæ„Åô': 'kai', 'Ê≠©„Åè': 'kai', 'Ê≠©„Åç„Åæ„Åô': 'kai', 
                    'Âãï„Åè': 'kai', 'Âãï„Åç„Åæ„Åô': 'kai', 'Â§â„Çè„Çã': 'kai', 'Â§â„Çè„Çä„Åæ„Åô': 'kai',
                    
                    'È£ü„Åπ„Çã': 'kin', 'È£ü„Åπ„Åæ„Åô': 'kin', 'È£≤„ÇÄ': 'kin', 'È£≤„Åø„Åæ„Åô': 'kin', 
                    'Âæó„Çã': 'kin', 'Âæó„Åæ„Åô': 'kin', '„ÇÇ„Çâ„ÅÜ': 'kin', '„ÇÇ„Çâ„ÅÑ„Åæ„Åô': 'kin',
                    
                    '„ÅÑ„Çã': 'ma', '„ÅÑ„Åæ„Åô': 'ma', '„ÅÇ„Çã': 'ma', '„ÅÇ„Çä„Åæ„Åô': 'ma', 
                    'Áîü„Åç„Çã': 'ma', 'Áîü„Åç„Åæ„Åô': 'ma',
                    
                    'Ë®Ä„ÅÜ': 'pa', 'Ë®Ä„ÅÑ„Åæ„Åô': 'pa', 'Ë©±„Åô': 'pa', 'Ë©±„Åó„Åæ„Åô': 'pa', 
                    'ËÅû„Åè': 'pa', 'ËÅû„Åç„Åæ„Åô': 'pa', 'Êõ∏„Åè': 'pa', 'Êõ∏„Åç„Åæ„Åô': 'pa', 
                    'Ë¶ã„Çã': 'pa', 'Ë¶ã„Åæ„Åô': 'pa', 'Ë™≠„ÇÄ': 'pa', 'Ë™≠„Åø„Åæ„Åô': 'pa',
                    'Êèè„Åè': 'pa', 'Êèè„Åç„Åæ„Åô': 'pa', 'ÊÑü„Åò„Çã': 'pa', 'ÊÑü„Åò„Åæ„Åô': 'pa', 
                    'ÈÄÅ„Çã': 'pa', 'ÈÄÅ„Çä„Åæ„Åô': 'pa', 'Âèó‰ø°': 'pa',
                    
                    'Áü•„Çã': 'sa', 'Áü•„Çä„Åæ„Åô': 'sa', '„Çè„Åã„Çã': 'sa', '„Çè„Åã„Çä„Åæ„Åô': 'sa', 
                    'Áøí„ÅÜ': 'sa', 'Áøí„ÅÑ„Åæ„Åô': 'sa', 'Â≠¶„Å∂': 'sa', 'Â≠¶„Å≥„Åæ„Åô': 'sa', 
                    'Êïô„Åà„Çã': 'sa', 'Êïô„Åà„Åæ„Åô': 'sa', 'ËÄÉ„Åà„Çã': 'sa', 'ËÄÉ„Åà„Åæ„Åô': 'sa',
                    
                    '‰Ωø„ÅÜ': 'sin', '‰Ωø„ÅÑ„Åæ„Åô': 'sin', '‰Ωø': 'sin', '‰Ωø„ÅÑ': 'sin', 
                    '„Åô„Çã': 'tin', '„Åó„Åæ„Åô': 'tin', '‰Ωú„Çã': 'tin', '‰Ωú„Çä„Åæ„Åô': 'tin', 
                    '„Å§„Åè„Çã': 'tin', '„Å§„Åè„Çä„Åæ„Åô': 'tin',
                    
                    // ÂΩ¢ÂÆπË©û„ÉªÂâØË©û
                    'Â§ß„Åç„ÅÑ': 'ni', 'Â§ß„Åç„Å™': 'ni', 'È´ò„ÅÑ': 'ni', 'Â§ö„ÅÑ': 'ni', '„Åü„Åè„Åï„Çì': 'ni', '„Å®„Å¶„ÇÇ': 'ni',
                    'Â§ß„Åç': 'ni', // Ê¥ªÁî®ÂØæÂøú
                    '„Çà„ÅÑ': 'sai', '„ÅÑ„ÅÑ': 'sai', 'Ê•Ω„Åó„ÅÑ': 'sai', 'Áæé„Åó„ÅÑ': 'sai',
                    'ËªΩ„ÅÑ': 'pai', 'Á∞°Âçò': 'pai', 'Á∞°Âçò„Å™': 'pai',
                    'Êòé„Çã„ÅÑ': 'pin', 'ÂÖâ': 'pin', 'Ëâ≤': 'pin',
                    
                    // ÂêçË©û
                    'ÁîüÁâ©': 'mai', 'ÂãïÁâ©': 'mai', '‰∫∫': 'mai', '‰∫∫Èñì': 'mai',
                    'Ë®ÄËëâ': 'pa', 'Èü≥': 'pa', 'ÊñáÂ≠ó': 'pa', 'Áµµ': 'pa', 'ÂÜôÁúü': 'pa',
                    'Áü•Ë≠ò': 'sa', 'ËÄÉ„Åà': 'sa',
                    'Â†¥ÊâÄ': 'ru', 'ÊôÇÈñì': 'ru', '„Å®„Åç': 'ru', '„Å®„Åì„Çç': 'ru',
                    
                    // Âõ∫ÊúâÂêçË©ûÔºà‰æãÔºâ
                    '„Éü„Ç´': 'mika', '„Å°„Åï': 'chisa', '„ÅØ„Å™': 'panaku', '„Ç´„Éä': 'kana',
                    '„Éë„Éã„Éë„Éã': 'panipani', 'Ê°ú': 'sakura',
                    
                    // „ÅÇ„ÅÑ„Åï„Å§  
                    '„ÇÑ„ÅÅ': 'na sai', '„Åì„Çì„Å´„Å°„ÅØ': 'pin ma', '„Åä„ÅØ„Çà„ÅÜ': 'pin kai',
                    '„Åì„Çì„Å∞„Çì„ÅØ': 'pin kai', '„Åä„ÇÑ„Åô„Åø': 'na pin kai na tin',
                    '„Åï„Çà„ÅÜ„Å™„Çâ': 'pu na sai', '„ÅÇ„Çä„Åå„Å®„ÅÜ': 'na na kai sai',
                    '„Åå„Çì„Å∞„Çå': 'na na kin sai', 'ÂÖÉÊ∞ó': 'sai'
                };

                // ÈÄÜÁøªË®≥ËæûÊõ∏„ÇíÊßãÁØâ
                this.buildReverseDict();
            }

            buildReverseDict() {
                this.panipaniToJa = {};
                
                // Âü∫Êú¨Ë™ûÂΩô„Åã„Çâ
                for (const [ja, pa] of Object.entries(this.japaneseToPs)) {
                    if (!this.panipaniToJa[pa]) {
                        this.panipaniToJa[pa] = [];
                    }
                    this.panipaniToJa[pa].push(ja);
                }

                // „ÅÇ„ÅÑ„Åï„Å§„Åã„Çâ
                for (const [pa, ja] of Object.entries(this.greetings)) {
                    const cleanPa = pa.replace(/[!?]/g, '');
                    if (!this.panipaniToJa[cleanPa]) {
                        this.panipaniToJa[cleanPa] = [];
                    }
                    this.panipaniToJa[cleanPa].push(ja.replace(/[!?]/g, ''));
                }

                // Ë°®Áèæ‰æã„Åã„Çâ
                for (const [pa, ja] of Object.entries(this.expressions)) {
                    if (!this.panipaniToJa[pa]) {
                        this.panipaniToJa[pa] = [];
                    }
                    this.panipaniToJa[pa].push(ja);
                }
            }

            // Êó•Êú¨Ë™û„ÅÆÂâçÂá¶ÁêÜ
            preprocessJapanese(text) {
                // Âè•Ë™≠ÁÇπÈô§Âéª
                text = text.replace(/[„ÄÇ„ÄÅÔºÅÔºü]/g, '');
                return text.trim();
            }

            // „Éë„Éã„Éë„Éã„ÅÆÂâçÂá¶ÁêÜ
            preprocessPanipani(text) {
                return text.toLowerCase().replace(/[!?]/g, '').trim();
            }

            // Êó•Êú¨Ë™ûÊñá„ÅÆÊßãÈÄ†Ëß£Êûê
            analyzeJapaneseSentence(text) {
                const processed = this.preprocessJapanese(text);
                console.log('Ëß£ÊûêÂØæË±°:', processed); // „Éá„Éê„ÉÉ„Ç∞Áî®
                
                // „Éë„Çø„Éº„É≥1: A „ÅØ B „Åß„Åô  
                let match = processed.match(/(.+?)„ÅØ(.+?)„Åß„Åô?$/);
                if (match) {
                    console.log('copula„Éû„ÉÉ„ÉÅ:', match[1], match[2]);
                    return {
                        type: 'copula',
                        subject: match[1].trim(),
                        predicate: match[2].trim()
                    };
                }

                // „Éë„Çø„Éº„É≥2: A „ÅØ B „Åó„Åæ„Åô Ôºà‰øÆÊ≠£ÔºöÂãïË©ûÊ¥ªÁî®„ÇÇËÄÉÊÖÆÔºâ
                match = processed.match(/(.+?)„ÅØ(.+?)(„Åó„Åæ„Åô|„Åæ„Åô)$/);
                if (match) {
                    console.log('verb„Éû„ÉÉ„ÉÅ:', match[1], match[2], match[3]);
                    return {
                        type: 'verb',
                        subject: match[1].trim(),
                        verb: match[2].trim() + match[3] // Ê¥ªÁî®Ëæº„Åø„ÅßÂá¶ÁêÜ
                    };
                }

                // „Éë„Çø„Éº„É≥3: A „ÅØ C „Çí B „Åó„Åæ„Åô
                match = processed.match(/(.+?)„ÅØ(.+?)„Çí(.+)/);
                if (match) {
                    console.log('transitive„Éû„ÉÉ„ÉÅ:', match[1], match[2], match[3]);
                    return {
                        type: 'transitive',
                        subject: match[1].trim(),
                        object: match[2].trim(),
                        verb: match[3].trim()
                    };
                }

                // „Éë„Çø„Éº„É≥4: Âê¶ÂÆöÊñá„ÇíÂê´„ÇÄË§áÈõë„Å™ÊßãÈÄ†
                if (processed.includes('„Å™„ÅÑ') || processed.includes('„Åæ„Åõ„Çì')) {
                    return this.analyzeNegativeSentence(processed);
                }

                // „Åù„ÅÆ‰ªñ„ÅÆ„Éë„Çø„Éº„É≥
                console.log('„Åù„ÅÆ‰ªñ„ÅÆ„Éë„Çø„Éº„É≥');
                return {
                    type: 'other',
                    words: processed.split(/\s+/)
                };
            }

            // Âê¶ÂÆöÊñá„ÅÆËß£Êûê
            analyzeNegativeSentence(text) {
                // ‰æã: „ÅØ„Å™„ÅØÂ§ß„Åç„Åè„Å™„ÅÑ
                let match = text.match(/^(.+?)„ÅØ(.+?)„Å™„ÅÑ$/);
                if (match) {
                    return {
                        type: 'negative_copula',
                        subject: match[1].trim(),
                        predicate: match[2].trim()
                    };
                }

                return {
                    type: 'negative_other',
                    text: text
                };
            }

            // ÂçòË™ûÁøªË®≥Ôºà‰øÆÊ≠£ÁâàÔºâ
            translateWord(word) {
                console.log('ÂçòË™ûÁøªË®≥:', word); // „Éá„Éê„ÉÉ„Ç∞Áî®
                
                // Áõ¥Êé•„Éû„ÉÉ„ÉÅÔºàÂÆåÂÖ®‰∏ÄËá¥„ÇíÂÑ™ÂÖàÔºâ
                if (this.japaneseToPs[word]) {
                    console.log('Áõ¥Êé•„Éû„ÉÉ„ÉÅ:', word, '‚Üí', this.japaneseToPs[word]);
                    return this.japaneseToPs[word];
                }

                // ÂãïË©ûÊ¥ªÁî®Âá¶ÁêÜÔºà„Çà„ÇäË©≥Á¥∞„Å´Ôºâ
                if (word.endsWith('„Åæ„Åô')) {
                    const withMasu = word; // „Åù„ÅÆ„Åæ„Åæ„ÉÅ„Çß„ÉÉ„ÇØ
                    if (this.japaneseToPs[withMasu]) {
                        console.log('„Åæ„Åô„Éû„ÉÉ„ÉÅ:', withMasu, '‚Üí', this.japaneseToPs[withMasu]);
                        return this.japaneseToPs[withMasu];
                    }
                    
                    const base = word.slice(0, -2);
                    if (this.japaneseToPs[base]) {
                        console.log('Ê¥ªÁî®„Éû„ÉÉ„ÉÅ:', base, '‚Üí', this.japaneseToPs[base]);
                        return this.japaneseToPs[base];
                    }
                }

                // „ÅÑ„Åæ„ÅôÂΩ¢„ÅÆÂá¶ÁêÜ
                if (word.endsWith('„ÅÑ„Åæ„Åô')) {
                    const withImasu = word; // „Åù„ÅÆ„Åæ„Åæ„ÉÅ„Çß„ÉÉ„ÇØ
                    if (this.japaneseToPs[withImasu]) {
                        console.log('„ÅÑ„Åæ„Åô„Éû„ÉÉ„ÉÅ:', withImasu, '‚Üí', this.japaneseToPs[withImasu]);
                        return this.japaneseToPs[withImasu];
                    }
                    
                    const base = word.slice(0, -3);
                    if (this.japaneseToPs[base]) {
                        console.log('„ÅÑ„Åæ„ÅôÊ¥ªÁî®„Éû„ÉÉ„ÉÅ:', base, '‚Üí', this.japaneseToPs[base]);
                        return this.japaneseToPs[base];
                    }
                }

                // ÂÄüÁî®Ë™û„Å®„Åó„Å¶Ëøî„Åô
                console.log('ÂÄüÁî®Ë™û:', word);
                return word.toLowerCase();
            }

            // „Éë„Éã„Éë„Éã‚ÜíÊó•Êú¨Ë™ûÂçòË™ûÁøªË®≥Ôºà‰øÆÊ≠£ÁâàÔºâ
            translatePanipaniWord(word) {
                // Âõ∫ÊúâÂêçË©û„ÅÆÂÑ™ÂÖàÂá¶ÁêÜ
                const properNouns = {
                    'mika': '„Éü„Ç´',
                    'chisa': '„Å°„Åï', 
                    'panaku': '„ÅØ„Å™',
                    'kana': '„Ç´„Éä',
                    'panipani': '„Éë„Éã„Éë„Éã',
                    'sakura': 'Ê°ú'
                };
                
                if (properNouns[word]) {
                    return properNouns[word];
                }
                
                // Âü∫Êú¨Ë™ûÂΩô„ÅÆÁøªË®≥
                if (this.panipaniToJa[word]) {
                    // ÊñáËÑà„Å´Âøú„Åò„ÅüÁøªË®≥ÈÅ∏Êäû
                    const candidates = this.panipaniToJa[word];
                    
                    // 'na' „ÅÆÂ†¥Âêà„ÅØÊñáËÑà„Å´Âøú„Åò„Å¶ÈÅ∏Êäû
                    if (word === 'na') {
                        // ÈÄöÂ∏∏„ÅØ„Äå„Åù„Çå„Äç„ÇíÂÑ™ÂÖàÔºà‰ª£ÊõøË°®Áèæ„Åß‰Ωø„Çè„Çå„Çã„Åì„Å®„ÅåÂ§ö„ÅÑÔºâ
                        return candidates.includes('„Åù„Çå') ? '„Åù„Çå' : candidates[0];
                    }
                    
                    return candidates[0];
                }
                
                return word;
            }

            // Êó•Êú¨Ë™û‚Üí„Éë„Éã„Éë„ÉãÁøªË®≥ÔºàÂÆåÂÖ®ÊñáÊ≥ïÂØæÂøú„Éª‰øÆÊ≠£ÁâàÔºâ
            translateToPs(text) {
                if (!text.trim()) return "";

                console.log('ÁøªË®≥ÈñãÂßã:', text); // „Éá„Éê„ÉÉ„Ç∞Áî®

                // „ÅÇ„ÅÑ„Åï„Å§„ÅÆÁõ¥Êé•„ÉÅ„Çß„ÉÉ„ÇØ
                for (const [pa, ja] of Object.entries(this.greetings)) {
                    if (text.includes(ja.replace(/[!?]/g, ''))) {
                        console.log('„ÅÇ„ÅÑ„Åï„Å§„Éû„ÉÉ„ÉÅ:', pa);
                        return pa;
                    }
                }

                // ÊñáÊßãÈÄ†Ëß£Êûê
                const structure = this.analyzeJapaneseSentence(text);
                console.log('ÊñáÊßãÈÄ†:', structure); // „Éá„Éê„ÉÉ„Ç∞Áî®

                switch (structure.type) {
                    case 'copula':
                        // A „ÅØ B „Åß„Åô ‚Üí A B
                        const subjPs = this.translateWord(structure.subject);
                        const predPs = this.translateWord(structure.predicate);
                        console.log('copula:', subjPs, predPs);
                        return `${subjPs} ${predPs}`;

                    case 'verb':
                        // A „ÅØ B „Åó„Åæ„Åô ‚Üí A A B Ôºà‰øÆÊ≠£ÔºöÂãïË©ûÊñá„ÅØ‰∏ªË™û„Çí2ÂõûÁπ∞„ÇäËøî„ÅôÔºâ
                        const subjVPs = this.translateWord(structure.subject);
                        const verbPs = this.translateWord(structure.verb);
                        console.log('verb:', subjVPs, subjVPs, verbPs);
                        return `${subjVPs} ${subjVPs} ${verbPs}`;

                    case 'transitive':
                        // A „ÅØ C „Çí B „Åó„Åæ„Åô ‚Üí A na A B. na C
                        const subjTPs = this.translateWord(structure.subject);
                        const objPs = this.translateWord(structure.object);
                        const verbTPs = this.translateWord(structure.verb);
                        console.log('transitive:', subjTPs, objPs, verbTPs);
                        return `${subjTPs} na ${subjTPs} ${verbTPs}. na ${objPs}`;

                    case 'negative_copula':
                        // „ÅØ„Å™„ÅØÂ§ß„Åç„Åè„Å™„ÅÑ ‚Üí pu ni panaku
                        const negSubj = this.translateWord(structure.subject);
                        const negPred = this.translateWord(structure.predicate);
                        console.log('negative:', negSubj, negPred);
                        return `pu ${negPred} ${negSubj}`;

                    default:
                        // „Åù„ÅÆ‰ªñ„ÅØÂçòË™û„Éô„Éº„ÇπÁøªË®≥
                        console.log('„Åù„ÅÆ‰ªñ„ÅÆÁøªË®≥');
                        const words = text.replace(/[„ÅØ„Çí„Å´]/g, ' ').split(/\s+/).filter(w => w);
                        const result = words.map(w => this.translateWord(w)).join(' ');
                        console.log('ÂçòË™û„Éô„Éº„ÇπÁµêÊûú:', result);
                        return result;
                }
            }

            // „Éë„Éã„Éë„Éã‚ÜíÊó•Êú¨Ë™ûÁøªË®≥ÔºàÂÆåÂÖ®ÊñáÊ≥ïÂØæÂøú„Éª‰øÆÊ≠£ÁâàÔºâ
            translateFromPs(text) {
                if (!text.trim()) return "";

                const processed = this.preprocessPanipani(text);

                // „ÅÇ„ÅÑ„Åï„Å§„ÅÆÁõ¥Êé•„ÉÅ„Çß„ÉÉ„ÇØ
                for (const [pa, ja] of Object.entries(this.greetings)) {
                    const cleanPa = this.preprocessPanipani(pa);
                    if (processed === cleanPa) {
                        return ja;
                    }
                }

                // Ë°®Áèæ‰æã„ÅÆÁõ¥Êé•„ÉÅ„Çß„ÉÉ„ÇØ
                if (this.expressions[processed]) {
                    return this.expressions[processed];
                }

                // Ë§áÊñá„ÅÆÂá¶ÁêÜÔºà. „ÅßÂå∫Âàá„Çâ„Çå„ÅüÊñáÔºâ
                if (processed.includes('.')) {
                    return this.translateComplexSentence(processed);
                }

                // ÊñáÊßãÈÄ†„ÅÆËß£Êûê„Å®ÁøªË®≥
                return this.analyzePanipaniStructure(processed);
            }

            // Ë§áÊñáÁøªË®≥Âá¶ÁêÜ
            translateComplexSentence(text) {
                const sentences = text.split('.').map(s => s.trim()).filter(s => s);
                
                if (sentences.length === 2) {
                    const first = sentences[0];
                    const second = sentences[1];
                    
                    // A na A B. na C „Éë„Çø„Éº„É≥„ÅÆÂá¶ÁêÜ
                    const firstWords = first.split(/\s+/);
                    const secondWords = second.split(/\s+/);
                    
                    if (firstWords.length === 4 && firstWords[1] === 'na' && 
                        firstWords[0] === firstWords[2] && 
                        secondWords.length >= 2 && secondWords[0] === 'na') {
                        
                        const subject = this.translatePanipaniWord(firstWords[0]);
                        const verb = this.translatePanipaniWord(firstWords[3]);
                        const object = secondWords.slice(1).map(w => this.translatePanipaniWord(w)).join('');
                        
                        return `${subject}„ÅØ${object}„Çí${verb}„Åó„Åæ„Åô`;
                    }
                }
                
                // „Åù„ÅÆ‰ªñ„ÅÆË§áÊñá„ÅØÂÄãÂà•„Å´ÁøªË®≥„Åó„Å¶ÁµêÂêà
                return sentences.map(s => this.analyzePanipaniStructure(s)).join('„ÄÇ');
            }

            // „Éë„Éã„Éë„ÉãÊñáÊßãÈÄ†Ëß£Êûê
            analyzePanipaniStructure(text) {
                const words = text.split(/\s+/).filter(w => w);

                // „Éë„Çø„Éº„É≥1: pu pu „ÅßÂßã„Åæ„ÇãÁñëÂïèÊñá
                if (words[0] === 'pu' && words[1] === 'pu') {
                    const content = words.slice(2).map(w => this.translatePanipaniWord(w)).join('');
                    return `${content}„Åß„Åô„ÅãÔºü`;
                }

                // „Éë„Çø„Éº„É≥2: Âê¶ÂÆöÊñá pu + Ë™û
                if (words[0] === 'pu') {
                    if (words.length === 3) {
                        // pu ni panaku ‚Üí „ÅØ„Å™„ÅØÂ§ß„Åç„Åè„Å™„ÅÑ
                        const adj = this.translatePanipaniWord(words[1]);
                        const subj = this.translatePanipaniWord(words[2]);
                        return `${subj}„ÅØ${adj}„Åè„Å™„ÅÑ`;
                    } else if (words.length === 4) {
                        // pu pa kana kana ‚Üí „Ç´„Éä„ÅØË©±„Åï„Å™„ÅÑ
                        const verb = this.translatePanipaniWord(words[1]);
                        const subj = this.translatePanipaniWord(words[2]);
                        return `${subj}„ÅØ${verb}„Åï„Å™„ÅÑ`;
                    }
                }

                // „Éë„Çø„Éº„É≥3: A A B ÔºàÂãïË©ûÊñá)
                if (words.length === 3 && words[0] === words[1]) {
                    const subj = this.translatePanipaniWord(words[0]);
                    const verb = this.translatePanipaniWord(words[2]);
                    return `${subj}„ÅØ${verb}„Åó„Åæ„Åô`;
                }

                // „Éë„Çø„Éº„É≥4: A B ÔºàÂêçË©ûÊñáÔºâ
                if (words.length === 2) {
                    const first = this.translatePanipaniWord(words[0]);
                    const second = this.translatePanipaniWord(words[1]);
                    return `${first}„ÅØ${second}„Åß„Åô`;
                }

                // „Éë„Çø„Éº„É≥5: A na A B ÂΩ¢ÂºèÔºà‰ª£ÊõøË°®Áèæ„ÅÆÁ¨¨1ÊñáÔºâ
                if (words.length === 4 && words[1] === 'na' && words[0] === words[2]) {
                    const subj = this.translatePanipaniWord(words[0]);
                    const verb = this.translatePanipaniWord(words[3]);
                    return `${subj}„ÅØ„Åù„Çå„Çí${verb}„Åó„Åæ„Åô`;
                }

                // „Éë„Çø„Éº„É≥6: na + Ë™ûÔºà‰ª£ÊõøË°®Áèæ„ÅÆÁ¨¨2ÊñáÔºâ
                if (words.length >= 2 && words[0] === 'na') {
                    const obj = words.slice(1).map(w => this.translatePanipaniWord(w)).join('');
                    return `„Åù„Çå„ÅØ${obj}„Åß„Åô`;
                }

                // „Éë„Çø„Éº„É≥7: ta „ÇíÂê´„ÇÄÁñëÂïèÊñá
                if (words.includes('ta')) {
                    const result = words.map(w => {
                        if (w === 'ta') return '‰Ωï';
                        return this.translatePanipaniWord(w);
                    }).join('');
                    return `${result}„Åß„Åô„ÅãÔºü`;
                }

                // „Éë„Çø„Éº„É≥8: ÂâçÁΩÆË©û‰ªò„Åç
                if (words[0] === 'nui') {
                    const prep = `nui ${words[1]}`;
                    if (this.prepositions[prep]) {
                        const meaning = this.prepositions[prep];
                        const rest = words.slice(2).map(w => this.translatePanipaniWord(w)).join('');
                        return `${meaning}${rest}`;
                    }
                }

                // „Éë„Çø„Éº„É≥9: „Åù„ÅÆ‰ªñ„ÅÆÂçòË™ûÂàó
                return words.map(w => this.translatePanipaniWord(w)).join('');
            }

            // ÁøªË®≥ÂàÜÊûêÔºà‰øÆÊ≠£ÁâàÔºâ
            analyzeTranslation(input, isReverse = false) {
                const analysis = [];
                
                if (isReverse) {
                    // „Éë„Éã„Éë„Éã‚ÜíÊó•Êú¨Ë™û„ÅÆÂàÜÊûê
                    if (input.includes('.')) {
                        analysis.push('ÊñáÂûã: Ë§áÊñáÔºàA na A B. na CÂΩ¢ÂºèÔºâ');
                        const sentences = input.split('.').map(s => s.trim()).filter(s => s);
                        sentences.forEach((sentence, i) => {
                            const words = sentence.split(/\s+/).filter(w => w);
                            analysis.push(`Á¨¨${i+1}Êñá: ${words.map(w => `'${w}'`).join(' ')}`);
                            words.forEach(word => {
                                const translated = this.translatePanipaniWord(word);
                                const meaning = this.vocabulary[word] || "Âõ∫ÊúâÂêçË©û„ÉªË°®Áèæ";
                                analysis.push(`  '${word}' ‚Üí '${translated}' (${meaning})`);
                            });
                        });
                    } else {
                        const words = this.preprocessPanipani(input).split(/\s+/).filter(w => w);
                        for (const word of words) {
                            const translated = this.translatePanipaniWord(word);
                            const meaning = this.vocabulary[word] || "Âõ∫ÊúâÂêçË©û„ÉªË°®Áèæ";
                            analysis.push(`'${word}' ‚Üí '${translated}' (${meaning})`);
                        }
                    }
                } else {
                    // Êó•Êú¨Ë™û‚Üí„Éë„Éã„Éë„Éã„ÅÆÂàÜÊûê
                    const structure = this.analyzeJapaneseSentence(input);
                    analysis.push(`ÊñáÂûã: ${this.getStructureDescription(structure.type)}`);
                    
                    if (structure.subject) {
                        const subjPs = this.translateWord(structure.subject);
                        analysis.push(`‰∏ªË™û: '${structure.subject}' ‚Üí '${subjPs}'`);
                    }
                    if (structure.predicate) {
                        const predPs = this.translateWord(structure.predicate);
                        analysis.push(`Ëø∞Ë™û: '${structure.predicate}' ‚Üí '${predPs}'`);
                    }
                    if (structure.verb) {
                        const verbPs = this.translateWord(structure.verb);
                        analysis.push(`ÂãïË©û: '${structure.verb}' ‚Üí '${verbPs}'`);
                    }
                    if (structure.object) {
                        const objPs = this.translateWord(structure.object);
                        analysis.push(`ÁõÆÁöÑË™û: '${structure.object}' ‚Üí '${objPs}'`);
                    }
                }
                
                return analysis;
            }

            // ÊñáÊßãÈÄ†„ÅÆË™¨Êòé
            getStructureDescription(type) {
                const descriptions = {
                    'copula': 'A „ÅØ B „Åß„ÅôÔºàÂêçË©ûÊñáÔºâ',
                    'verb': 'A „ÅØ B „Åó„Åæ„ÅôÔºàÂãïË©ûÊñáÔºâ‚Üí A A B',
                    'transitive': 'A „ÅØ C „Çí B „Åó„Åæ„ÅôÔºà‰ªñÂãïË©ûÊñáÔºâ',
                    'negative_copula': 'Âê¶ÂÆöÊñáÔºàÂΩ¢ÂÆπË©ûÔºâ',
                    'negative_other': 'Âê¶ÂÆöÊñáÔºà„Åù„ÅÆ‰ªñÔºâ',
                    'other': '„Åù„ÅÆ‰ªñ„ÅÆÊñáÂûã'
                };
                return descriptions[type] || '‰∏çÊòé„Å™ÊñáÂûã';
            }
        }

        // „Ç¢„Éó„É™ÂàùÊúüÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            const engine = new PaniPaniGrammarEngine();
            let isReverse = false;
            
            // DOMË¶ÅÁ¥†„ÅÆÂèñÂæó
            const modeJaToPa = document.getElementById('modeJaToPa');
            const modePaToJa = document.getElementById('modePaToJa');
            const modeText = document.getElementById('modeText');
            const exampleText = document.getElementById('exampleText');
            const inputLabel = document.getElementById('inputLabel');
            const outputLabel = document.getElementById('outputLabel');
            const inputText = document.getElementById('inputText');
            const output = document.getElementById('output');
            const analysisOutput = document.getElementById('analysisOutput');
            const translateBtn = document.getElementById('translateBtn');
            const clearBtn = document.getElementById('clearBtn');
            const vocabBtn = document.getElementById('vocabBtn');
            const phrasesBtn = document.getElementById('phrasesBtn');
            
            // „É¢„Éº„ÉÄ„É´Èñ¢ÈÄ£
            const vocabModal = document.getElementById('vocabModal');
            const phrasesModal = document.getElementById('phrasesModal');
            const vocabList = document.getElementById('vocabList');
            const greetingsList = document.getElementById('greetingsList');
            const expressionsList = document.getElementById('expressionsList');
            const prepositionsList = document.getElementById('prepositionsList');
            
            // Ë™ûÂΩôË°®„ÅÆË®≠ÂÆö
            const vocabItems = Object.entries(engine.vocabulary)
                .map(([word, meaning]) => 
                    `<div class="vocab-item"><strong>${word}</strong>: ${meaning}</div>`
                ).join('');
            vocabList.innerHTML = vocabItems;

            // „ÅÇ„ÅÑ„Åï„Å§„ÉªÊÖ£Áî®Âè•„ÅÆË®≠ÂÆö
            const greetingsItems = Object.entries(engine.greetings)
                .map(([panipani, japanese]) => 
                    `<div class="phrase-item">
                        <div class="phrase-panipani">${panipani}</div>
                        <div class="phrase-meaning">${japanese}</div>
                    </div>`
                ).join('');
            greetingsList.innerHTML = greetingsItems;

            const expressionsItems = Object.entries(engine.expressions)
                .map(([panipani, japanese]) => 
                    `<div class="phrase-item">
                        <div class="phrase-panipani">${panipani}</div>
                        <div class="phrase-meaning">${japanese}</div>
                    </div>`
                ).join('');
            expressionsList.innerHTML = expressionsItems;

            const prepositionsItems = Object.entries(engine.prepositions)
                .map(([panipani, japanese]) => 
                    `<div class="phrase-item">
                        <div class="phrase-panipani">${panipani}</div>
                        <div class="phrase-meaning">${japanese}</div>
                    </div>`
                ).join('');
            prepositionsList.innerHTML = prepositionsItems;

            // ‰æãÊñá„Çª„ÉÉ„Éà
            const examples = {
                ja: [
                    '„ÅÇ„Çå„ÅØÊ°ú„Åß„Åô',
                    '„Å°„Åï„ÅØË°å„Åç„Åæ„Åô', 
                    '„Éü„Ç´„ÅØ„Éë„Éã„Éë„Éã„Çí‰Ωø„ÅÑ„Åæ„Åô',
                    '„ÅØ„Å™„ÅØÂ§ß„Åç„Åè„Å™„ÅÑ',
                    '„ÇÑ„ÅÅÔºÅ'
                ],
                pa: [
                    'na sakura',
                    'chisa chisa kai',
                    'mika na mika sin. na panipani',
                    'pu ni panaku',
                    'na sai'
                ]
            };

            let currentExampleIndex = 0;

            // UI„ÇíÊõ¥Êñ∞„Åô„ÇãÈñ¢Êï∞
            function updateUI() {
                if (isReverse) {
                    // „Éë„Éã„Éë„Éã‚ÜíÊó•Êú¨Ë™û„É¢„Éº„Éâ
                    modeJaToPa.classList.remove('active');
                    modePaToJa.classList.add('active');
                    modeText.textContent = '„Éë„Éã„Éë„ÉãË™û ‚Üí Êó•Êú¨Ë™û';
                    inputLabel.textContent = 'üå∏ „Éë„Éã„Éë„ÉãË™û„ÇíÂÖ•Âäõ:';
                    outputLabel.textContent = 'üáØüáµ Êó•Êú¨Ë™û:';
                    inputText.placeholder = '‰æã: na sakura';
                    exampleText.textContent = examples.pa[currentExampleIndex];
                } else {
                    // Êó•Êú¨Ë™û‚Üí„Éë„Éã„Éë„Éã„É¢„Éº„Éâ
                    modeJaToPa.classList.add('active');
                    modePaToJa.classList.remove('active');
                    modeText.textContent = 'Êó•Êú¨Ë™û ‚Üí „Éë„Éã„Éë„ÉãË™û';
                    inputLabel.textContent = 'üáØüáµ Êó•Êú¨Ë™û„ÇíÂÖ•Âäõ:';
                    outputLabel.textContent = 'üåü „Éë„Éã„Éë„ÉãË™û:';
                    inputText.placeholder = '‰æã: „ÅÇ„Çå„ÅØÊ°ú„Åß„Åô';
                    exampleText.textContent = examples.ja[currentExampleIndex];
                }
            }
            
            // ÁøªË®≥Ê©üËÉΩ
            function translate() {
                const input = inputText.value.trim();
                if (!input) {
                    alert('„ÉÜ„Ç≠„Çπ„Éà„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                    return;
                }
                
                try {
                    let result, analysis;
                    if (isReverse) {
                        // „Éë„Éã„Éë„Éã‚ÜíÊó•Êú¨Ë™û
                        result = engine.translateFromPs(input);
                        analysis = engine.analyzeTranslation(input, true);
                    } else {
                        // Êó•Êú¨Ë™û‚Üí„Éë„Éã„Éë„Éã
                        result = engine.translateToPs(input);
                        analysis = engine.analyzeTranslation(input, false);
                    }
                    
                    output.textContent = result;
                    output.classList.remove('empty');
                    analysisOutput.innerHTML = analysis.join('<br>');
                    
                    // ÊàêÂäüÊôÇ„ÅÆ„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥
                    output.style.animation = 'none';
                    setTimeout(() => {
                        output.style.animation = 'bounce 0.5s ease';
                    }, 10);
                    
                } catch (error) {
                    console.error('ÁøªË®≥„Ç®„É©„Éº:', error);
                    output.textContent = '„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü';
                    analysisOutput.textContent = '„Ç®„É©„Éº: ' + error.message;
                }
            }
            
            // „ÇØ„É™„Ç¢Ê©üËÉΩ
            function clearAll() {
                inputText.value = '';
                output.textContent = '„Åì„Åì„Å´ÁøªË®≥ÁµêÊûú„ÅåË°®Á§∫„Åï„Çå„Åæ„Åô';
                output.classList.add('empty');
                analysisOutput.textContent = '';
            }
            
            // „Ç§„Éô„É≥„Éà„É™„Çπ„Éä„Éº
            modeJaToPa.addEventListener('click', () => {
                isReverse = false;
                updateUI();
                clearAll();
            });

            modePaToJa.addEventListener('click', () => {
                isReverse = true;
                updateUI();
                clearAll();
            });

            translateBtn.addEventListener('click', translate);
            clearBtn.addEventListener('click', clearAll);
            
            // Enter„Ç≠„Éº„ÅßÁøªË®≥
            inputText.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    translate();
                }
            });
            
            // Ë™ûÂΩôË°®„É¢„Éº„ÉÄ„É´
            vocabBtn.addEventListener('click', function() {
                vocabModal.classList.add('show');
            });

            // „ÅÇ„ÅÑ„Åï„Å§„É¢„Éº„ÉÄ„É´
            phrasesBtn.addEventListener('click', function() {
                phrasesModal.classList.add('show');
            });
            
            // „É¢„Éº„ÉÄ„É´„ÇØ„É≠„Éº„Ç∫
            document.getElementById('closeVocabModal').addEventListener('click', function() {
                vocabModal.classList.remove('show');
            });

            document.getElementById('closePhrasesModal').addEventListener('click', function() {
                phrasesModal.classList.remove('show');
            });
            
            // „É¢„Éº„ÉÄ„É´Â§ñ„ÇØ„É™„ÉÉ„ÇØ„ÅßÈñâ„Åò„Çã
            [vocabModal, phrasesModal].forEach(modal => {
                modal.addEventListener('click', function(e) {
                    if (e.target === modal) {
                        modal.classList.remove('show');
                    }
                });
            });

            // „Çø„ÉñÂàá„ÇäÊõø„ÅàÊ©üËÉΩ
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const targetTab = this.dataset.tab;
                    
                    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                    
                    this.classList.add('active');
                    document.getElementById(targetTab).classList.add('active');
                });
            });

            // ‰æãÊñá„ÇØ„É™„ÉÉ„ÇØ„ÅßËá™ÂãïÂÖ•ÂäõÔºÜÁøªË®≥
            exampleText.addEventListener('click', function() {
                inputText.value = exampleText.textContent;
                translate();
                
                // Ê¨°„ÅÆ‰æãÊñá„Å´Êõ¥Êñ∞
                currentExampleIndex = (currentExampleIndex + 1) % examples.ja.length;
                setTimeout(() => updateUI(), 1000);
            });

            // „Éï„É¨„Éº„Ç∫„ÇØ„É™„ÉÉ„ÇØ„ÅßËá™ÂãïÂÖ•Âäõ
            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('phrase-panipani')) {
                    const phraseText = e.target.textContent;
                    if (isReverse) {
                        inputText.value = phraseText;
                    } else {
                        const meaningElement = e.target.nextElementSibling;
                        if (meaningElement) {
                            inputText.value = meaningElement.textContent.replace(/[!?]/g, '');
                        }
                    }
                    
                    phrasesModal.classList.remove('show');
                    translate();
                }
            });

            // ÂàùÊúüUIË®≠ÂÆö
            updateUI();
        });

        // CSS AnimationËøΩÂä†
        const style = document.createElement('style');
        style.textContent = `
            @keyframes bounce {
                0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
                40% { transform: translateY(-10px); }
                60% { transform: translateY(-5px); }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>
